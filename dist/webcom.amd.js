define(["require","exports"],(function(t,e){"use strict";function n(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}const i=(1+Math.sqrt(5))/2-1,o=(t,e,n,i=!0)=>i?t>=e&&t<=n:t>e&&t<n,r=(t,e)=>Math.floor(Math.random()*(e+1-t))+t,a=(t,e=2)=>{let n=Math.pow(10,e);return Math.round(t*n)/n},l=(t,e,n)=>{void 0===n&&(n="...");let i=/[^\x00-\xff]/g;if(t.replace(i,"mm").length<=e)return t;for(let o=Math.floor(e/2);o<t.length;o++)if(t.substr(0,o).replace(i,"mm").length>=e)return t.substr(0,o)+n;return t},s=t=>(t+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1"),c=t=>{let e="",n=0,i=0,o=0,r=0;for(;n<t.length;)i=t.charCodeAt(n),i<128?(e+=String.fromCharCode(i),n++):i>191&&i<224?(o=t.charCodeAt(n+1),e+=String.fromCharCode((31&i)<<6|63&o),n+=2):(o=t.charCodeAt(n+1),r=t.charCodeAt(n+2),e+=String.fromCharCode((15&i)<<12|(63&o)<<6|63&r),n+=3);return e},d=t=>{t=t.replace(/\r\n/g,"n");let e="";for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<128?e+=String.fromCharCode(i):i>127&&i<2048?(e+=String.fromCharCode(i>>6|192),e+=String.fromCharCode(63&i|128)):(e+=String.fromCharCode(i>>12|224),e+=String.fromCharCode(i>>6&63|128),e+=String.fromCharCode(63&i|128))}return e},h=(t=6,e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890")=>{let n="";for(let i=0;i<t;i++){let t=Math.round(Math.random()*(e.length-1));n+=e.substring(t,t+1)}return n},p=(t=1,e=8)=>{let n=[];const i="bcdfghjklmnpqrstvwxyz",o="aeiou";for(;t-- >0;){let t="";for(let n=0;n<e;n+=3)t+=i[Math.floor(21*Math.random())],t+=o[Math.floor(5*Math.random())],t+=i[Math.floor(21*Math.random())];n.push(t)}return n},u=(t=0,e=!1)=>{let n=Math.ceil(t/4),i=p(n);if(e){let t="",e="";return i.forEach((n=>{e=e+t+n,t=r(0,1)>0?" ":"\n"})),e.trim()}return i.join(" ").substring(0,t).trim()},m=(t,e=!1)=>{let n=[];return t.replace(/[-_\s+]/g," ").split(" ").forEach(((t,i)=>{n.push(0!==i||e?g(t):t)})),n.join("")},g=t=>"string"!=typeof t?"":t.charAt(0).toUpperCase()+t.slice(1),f=t=>!isNaN(t),b=["body","h1","h2","h3","h4","h5","h6","hr","p","div","address","pre","form","table","li","ol","ul","tr","td","caption","blockquote","center","legend","dl","dt","dd","dir","fieldset","noscript","noframes","menu","isindex","samp","nav","header","aside","dialog","section","footer","article"],v=["style","comment","select","option","script","title","head","button"],w=t=>f(t)?t+"px":t+"";let $;const y=t=>String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\s/g,"&nbsp;").replace(/[\r\n]/g,"<br/>"),E=(t,e="")=>(e=e?"&#13;":"\n",(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,e).replace(/[\r\n]/g,e)),x=(t,e,n='<span class="matched">%s</span>')=>e?t.replace(new RegExp(s(e),"ig"),(t=>n.replace("%s",t))):t;let A=0;const _=(t="")=>"guid_"+(t||h(6))+ ++A,T=function(){let t,e=new Error,n=new RegExp(T.name+"\\s*\\((.*):\\d+:\\d+\\)"),i=new RegExp(/.+\/(.*?):\d+(:\d+)*$/);return(t=n.exec(e.stack.trim()))||(t=i.exec(e.stack.trim()))&&""!==t[1]?t[1]:void 0!==e.fileName?e.fileName:null},C="/Lang/Util.js",L=()=>{let t=T();if(!t)throw"Get script failed";return t.indexOf(C)>=0?t.replace(C,"/index.js"):t},S=async()=>{let e=L();return await(i=e,new Promise((function(e,o){t([i],(function(t){e(n(t))}),o)})));var i},N=(()=>{if(top===window)return S;if(top.WEBCOM_GET_LIB_MODULE)return top.WEBCOM_GET_LIB_MODULE;throw"No WebCom library script loaded detected."})(),I=t=>{let e,n,i,o,r,a=(t?t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"):"").split("."),l=[];for(r=0;r<a.length;r+=1)i=a[r].replace(/\D/g,""),o=parseInt(i,10),isNaN(o)&&(o=0),l.push(o);for(e=l.length,r=e-1;r>=0&&(n=l[r],0===n);r-=1)l.length-=1;return l};const O=t=>t&&"object"==typeof t&&!Array.isArray(t),k=(t,...e)=>{if(!e.length)return t;const n=e.shift();if(O(t)&&O(n))for(const e in n)O(n[e])?(t[e]?t[e]=Object.assign({},t[e]):Object.assign(t,{[e]:{}}),k(t[e],n[e])):Object.assign(t,{[e]:n[e]});return k(t,...e)},P="pending",R="fulfilled",M="rejected";window.WEBCOM_GET_LIB_MODULE=S,window.WEBCOM_GET_SCRIPT_ENTRY=L;const D=t=>{t.style.display="none"},F=t=>!(!t||!t.parentNode)&&(t.parentNode.removeChild(t),!0),U=t=>{t.style.display=""},H=(t,e=document)=>e.querySelector(t),z=(t,e=document)=>(0!==(t=t.trim()).indexOf(":scope")&&(t=":scope "+t),Array.from(e.querySelectorAll(t))),q=t=>{let e=t.getBoundingClientRect();return{width:e.width,height:e.height,top:e.top,bottom:e.bottom,left:e.left,right:e.right,x:e.x,y:e.y}},B=t=>"BUTTON"===t.tagName||"INPUT"===t.tagName&&["button","reset","submit"].includes(t.getAttribute("type")),V=(t,e,n=!1)=>{"string"==typeof t?t=z(t):Array.isArray(t)||"object"==typeof t&&(t=[t]);for(let i=0;i<t.length;i++)if(n&&t[i]===e||16&t[i].compareDocumentPosition(e))return!0;return!1},W=t=>null===t.offsetParent,G=(t,e,n=!0)=>{let i=null;const o="ON_DOM_TREE_CHANGE_BIND_"+_(),r=()=>{i&&clearTimeout(i),i=setTimeout(e,0)},a=t=>{t&&t.length&&t.forEach((t=>{t.setAttribute(o,"1"),t.addEventListener("change",r)}))};new MutationObserver((()=>{if(n){let e=t.querySelectorAll(`input:not([${o}]), textarea:not([${o}]), select:not([${o}])`);a(e)}r()})).observe(t,{attributes:!0,subtree:!0,childList:!0}),n&&a(t.querySelectorAll("input,textarea,select"))},j=(t,e,n,i=!0)=>{G(t,(()=>{n(z(e,t))})),i&&n(z(e,t))},Y=(t,e={left:0,top:0,width:window.innerWidth,height:window.innerHeight})=>{let n={left:t.left,top:t.top};return t.width>e.width||t.height>e.height||(t.width+t.left>e.width+e.left&&(n.left=t.left-(t.width+t.left-(e.width+e.left))),t.height+t.top>e.height+e.top&&(n.top=t.top-(t.height+t.top-(e.height+e.top))),t.left<e.left&&(n.left=e.left),t.top<e.top&&(n.top=e.top)),n},J=t=>{let e,n,i=t.style.visibility,o=t.style.display;return t.style.visibility="hidden",t.style.display="block",e=t.clientWidth,n=t.clientHeight,t.style.visibility=i,t.style.display=o,{width:e,height:n}};let X={};const K=(t,e="",n=document)=>{let i=n.createElement("style");return n.head.appendChild(i),i.innerHTML=t,e&&(i.id=e),i},Q=(t=window)=>{let e={},n=t.document;if(e.screenLeft=t.screenLeft?t.screenLeft:t.screenX,e.screenTop=t.screenTop?t.screenTop:t.screenY,t.innerWidth)e.visibleWidth=t.innerWidth,e.visibleHeight=t.innerHeight,e.horizenScroll=t.pageXOffset,e.verticalScroll=t.pageYOffset;else{let t=n.documentElement&&n.documentElement.clientWidth?n.documentElement:n.body;e.visibleWidth=t.clientWidth,e.visibleHeight=t.clientHeight,e.horizenScroll=t.scrollLeft,e.verticalScroll=t.scrollTop}let i=n.documentElement&&n.documentElement.scrollWidth?n.documentElement:n.body;return e.documentWidth=Math.max(i.scrollWidth,e.visibleWidth),e.documentHeight=Math.max(i.scrollHeight,e.visibleHeight),e},Z=(t,e)=>o(t.top,e.top,e.top+e.height)&&o(t.left,e.left,e.left+e.width)&&o(t.top+t.height,e.top,e.top+e.height)&&o(t.left+t.width,e.left,e.left+e.width),tt=(t,e={})=>{for(let n in e)n=m(n),t.style[n]=w(e[n])},et=(t,e,n)=>{let i=0;if(3===t.nodeType){e=new RegExp(e,"i");let o=t.data.search(e);if(o>=0&&t.data.length>0){let r=t.data.match(e),a=document.createElement("span");a.className=n;let l=t.splitText(o);l.splitText(r[0].length);let s=l.cloneNode(!0);a.appendChild(s),l.parentNode.replaceChild(a,l),i=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName))for(let i=0;i<t.childNodes.length;++i)i+=et(t.childNodes[i],e,n);return i},nt=(t,e=null)=>{let n=document.createElement("template");t=t.trim(),n.innerHTML=t;let i=[];return e?n.content.childNodes.forEach((t=>{i.push(e.appendChild(t))})):i=n.content.childNodes,1===i.length?i[0]:i};const it=t=>{if(t.requestFullscreen)return t.requestFullscreen();if(t.webkitRequestFullScreen)return t.webkitRequestFullScreen();throw t.mozRequestFullScreen&&t.mozRequestFullScreen(),t.msRequestFullScreen&&t.msRequestFullScreen(),"Browser no allow full screen"},ot=()=>document.exitFullscreen(),rt=()=>!!document.fullscreenElement;let at;const lt=()=>{if(at)return at;let t;try{for(t=window;t!=t.parent;)t=t.parent}catch(t){console.warn("context window assign fail:",t)}return t||window},st=(t,e,n,i="/")=>{var o="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),o="; expires="+r.toUTCString()}document.cookie=t+"="+(e||"")+o+"; path="+i},ct=t=>{for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return null},dt="WebCom-",ht="--"+dt,pt=dt+"iconfont",ut=ht+"color",mt=ht+"color-lighten",gt=ht+"disable-color",ft=ht+"background-color",bt=ht+"panel-shadow",vt=ht+"panel-border",wt=ht+"panel-border-color",$t=ht+"panel-radius",yt=ht+"full-screen-backdrop-filter",Et=ht+"full-screen-background-color";K(`\n@font-face {\n\tfont-family: '${pt}';  /* Project id 3359671 */\n\tsrc: url('//at.alicdn.com/t/c/font_3359671_6sdhf2dfnne.woff2?t=1703834753032') format('woff2'),\n       url('//at.alicdn.com/t/c/font_3359671_6sdhf2dfnne.woff?t=1703834753032') format('woff'),\n       url('//at.alicdn.com/t/c/font_3359671_6sdhf2dfnne.ttf?t=1703834753032') format('truetype');\n}\n:root {\n\t${ut}:#333;\n\t${mt}:#666;\n\t${gt}:#aaa;\n\t${ft}:#fff;\n\t\n\t${bt}:1px 1px 5px #bcbcbcb3;\n\t${wt}:#ccc;\n\t${vt}:1px solid var(${wt});\n\t${$t}:4px;\n\t\n\t${yt}:blur(4px);\n\t${Et}:#33333342;\n}`,dt+"style");const xt={Namespace:dt,CssVarPrefix:ht,CssVar:{COLOR:ut,CSS_LIGHTEN:mt,DISABLE_COLOR:gt,BACKGROUND_COLOR:ft,PANEL_SHADOW:bt,PANEL_BORDER:vt,PANEL_BORDER_COLOR:wt,PANEL_RADIUS:$t,FULL_SCREEN_BACKDROP_FILTER:yt,FULL_SCREEN_BACKGROUND_COLOR:Et},IconFont:pt,TipIndex:10,MaskIndex:100,DialogIndex:1e3,FullScreenModeIndex:1e4,ContextIndex:1e5,ToastIndex:1e6},At=xt.Namespace+"toast",_t=xt.Namespace+"toast",Tt=xt.Namespace+"-toast-rotate",Ct=xt.Namespace+"-toast-fadein",Lt=xt.Namespace+"-toast-fadeout";K(`\n\t@keyframes ${Tt} {\n\t    0% {transform:scale(1.4) rotate(0deg);}\n\t    100% {transform:scale(1.4) rotate(360deg);}\n\t}\n\t@keyframes ${Ct} {\n\t\t0% { opacity: 0; }\n\t\t100% { opacity: 1; } \n\t}\n\t@keyframes ${Lt} {\n\t\t0% { opacity:1;}\n\t\t100% { opacity: 0} \n\t}\n\t.${_t}-wrap{position:absolute; margin:0; padding:0; top:5px; pointer-events:none; background-color:transparent; width:100%; border:none; text-align:center; z-index:${xt.ToastIndex};}\n\t.${_t} {pointer-events:auto}\n\t.${_t}>span {margin-bottom:0.5rem;}\n\t.${_t} .ctn{display:inline-block;border-radius:3px;padding:.5rem 1rem .5rem 2.8rem; text-align:left; line-height:1.5rem; background-color:var(${xt.CssVar.BACKGROUND_COLOR});color:var(${xt.CssVar.COLOR});box-shadow:var(${xt.CssVar.PANEL_SHADOW}); animation:${Ct} 200ms}\n\t.${_t} .ctn:before {content:"";font-family:${xt.IconFont}; position:absolute; font-size:1.4rem; margin-left:-1.8rem;}\n\t.${_t}-hide .ctn {animation:${Lt} 500ms; animation-fill-mode:forwards}\n\t.${_t}-info .ctn:before {content:"\\e77e";color: gray;}\n\t.${_t}-warning .ctn:before {content:"\\e673"; color:orange}\n\t.${_t}-success .ctn:before {content:"\\e78d"; color:#007ffc}\n\t.${_t}-error .ctn:before {content: "\\e6c6"; color:red;} \n\t.${_t}-loading .ctn:before {content:"\\e635";color:gray;animation: 1.5s linear infinite ${Tt};animation-play-state: inherit;transform:scale(1.4);will-change: transform}\n`,At+"-style");let St=null;const Nt=()=>(St||(St=nt(`<div class="${_t}-wrap" popover="manual"></div>`,document.body)),St);class It{static TYPE_INFO="info";static TYPE_SUCCESS="success";static TYPE_WARNING="warning";static TYPE_ERROR="error";static TYPE_LOADING="loading";static DEFAULT_TIME_MAP={[It.TYPE_INFO]:1500,[It.TYPE_SUCCESS]:1500,[It.TYPE_WARNING]:2e3,[It.TYPE_ERROR]:2500,[It.TYPE_LOADING]:0};message="";type=It.TYPE_INFO;timeout=It.DEFAULT_TIME_MAP[this.type];dom=null;constructor(t,e=null,n=null){this.message=t,this.type=e||It.TYPE_SUCCESS,this.timeout=null===n?It.DEFAULT_TIME_MAP[this.type]:n}static showToast=(t,e=null,n=null,i=null)=>{let o=new It(t,e,n);return o.show(i),o};static showInfo=(t,e=null)=>this.showToast(t,It.TYPE_INFO,this.DEFAULT_TIME_MAP[It.TYPE_INFO],e);static showSuccess=(t,e=null)=>this.showToast(t,It.TYPE_SUCCESS,this.DEFAULT_TIME_MAP[It.TYPE_SUCCESS],e);static showWarning=(t,e=null)=>this.showToast(t,It.TYPE_WARNING,this.DEFAULT_TIME_MAP[It.TYPE_WARNING],e);static showError=(t,e=null)=>this.showToast(t,It.TYPE_ERROR,this.DEFAULT_TIME_MAP[It.TYPE_ERROR],e);static showLoading=(t,e=null)=>this.showToast(t,It.TYPE_LOADING,this.DEFAULT_TIME_MAP[It.TYPE_LOADING],e);static showLoadingLater=(t,e=200,n=null)=>{let i=It.DEFAULT_TIME_MAP[It.TYPE_LOADING],o=new It(t,It.TYPE_LOADING,i);return o.show(n),D(o.dom),setTimeout((()=>{o.dom&&U(o.dom)}),e),o};show(t=null){let e=Nt();e.showPopover(),this.dom=nt(`<span class="${_t} ${_t}-${this.type}">\n\t\t\t\t<span class="ctn">${this.message}</span><div></div>\n\t\t\t</span>`,e),this.timeout&&setTimeout((()=>{this.hide(!0),t&&t()}),this.timeout)}hide(t=!1){if(!this.dom||!document.body.contains(this.dom))return;if(t)return this.dom.classList.add(_t+"-hide"),void setTimeout((()=>{this.hide(!1)}),500);F(this.dom),this.dom=null;let e=Nt();e.childNodes.length||e.hidePopover()}}window[At]=It;let Ot=lt()[At]||It;const kt=t=>{if(t.indexOf(".")<0)return"";let e=t.split(".");return e[e.length-1]},Pt=t=>(t=t.replace(/.*?[/|\\]/gi,"")).replace(/\.[^.]*$/g,"");class Rt{events=[];breakOnFalseReturn=!1;constructor(t=!1){this.breakOnFalseReturn=t}listen(t){this.events.push(t)}remove(t){this.events=this.events.filter((e=>e!==t))}clean(){this.events=[]}fire(...t){let e=!1;return this.events.forEach((n=>{let i=n.apply(null,t);if(this.breakOnFalseReturn&&!1===i)return e=!0,!1})),!e}}const Mt=(t,e,n=!1,i=!1)=>{t.addEventListener("click",e,n),t.addEventListener("keyup",(n=>{n.keyCode!==Ut.Space&&n.keyCode!==Ut.Enter||e.call(t,n)}),n),i&&e.call(t,null)},Dt=(t,e)=>{if("createEvent"in document){let n=document.createEvent("HTMLEvents");n.initEvent(e.toLowerCase(),!1,!0),t.dispatchEvent(n)}else t.fireEvent("on"+e.toLowerCase())},Ft=(t,e,n,i)=>{t.addEventListener(n,(n=>{let o=n.target;for(;o;){if(o.matches(e))return void i.call(o,n,o);if(o===t)return;o=o.parentNode}}))},Ut={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,BackSpace:8,Esc:27,RightArrow:39,Tab:9,Space:32,DownArrow:40,Clear:12,PageUp:33,Insert:45,Enter:13,PageDown:34,Delete:46,Shift:16,End:35,NumLock:144,Control:17,Home:36,Alt:18,LeftArrow:37,CapsLock:20,UpArrow:38,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NumPad0:96,NumPad1:97,NumPad2:98,NumPad3:99,NumPad4:100,NumPad5:101,NumPad6:102,NumPad7:103,NumPad8:104,NumPad9:105,NumPadMultiple:106,NumPadPlus:107,NumPadDash:109,NumPadDot:110,NumPadSlash:111,NumPadEnter:108},Ht={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",OPTIONS:"OPTIONS",HEAD:"HEAD",CONNECT:"CONNECT",TRACE:"TRACE"},zt={JSON:"JSON",FORM:"FORM"},qt={[zt.JSON]:"application/json",[zt.FORM]:"application/x-www-form-urlencoded"},Bt={[zt.JSON]:(t,e)=>{if(e===Ht.GET)return"";if(t instanceof FormData){let e={};return t.forEach(((t,n)=>{e[n]=t})),JSON.stringify(e)}return JSON.stringify(t)},[zt.FORM]:(t,e)=>e===Ht.GET?"":t instanceof FormData?t:Qt.stringify(t)},Vt={JSON:"JSON",XML:"XML",HTML:"HTML",TEXT:"TEXT"},Wt={[Vt.JSON]:"application/json",[Vt.XML]:"text/xml",[Vt.HTML]:"text/html",[Vt.TEXT]:"text/plain"},Gt=(t,e)=>t+(t.indexOf("?")>=0?"&":"?")+Qt.stringify(e),jt=()=>location.hash?location.hash.substring(1):"",Yt=(t,e,n=Ht.GET,i={})=>n===Ht.GET?Xt.getJSON(t,e,i):Xt.postJSON(t,e,i),Jt=(t,e,n,i=null)=>{let{onSuccess:o,onProgress:r,onError:a,onAbort:l}=n;r=r||function(){},a=a||function(t){Ot.showError(t)},l=l||a;let s=new FormData,c=0;for(let t in e)s.append(t,e[t]),c+=e[t].size;if(i)for(let t in i)s.append(t,i[t]);let d=new XMLHttpRequest;return d.withCredentials=!0,d.upload.addEventListener("progress",(t=>{r(t.loaded,c)}),!1),d.addEventListener("load",(()=>{4===d.readyState&&(200===d.status?(r(c,c),o(d.responseText)):a(d.responseText||d.statusText))})),d.addEventListener("error",(t=>{a(t)})),d.addEventListener("abort",(()=>{l("请求中断")})),d.open("POST",t),d.setRequestHeader("Accept",Wt[Vt.JSON]),d.send(s),d};class Xt{cgi=null;data=null;option={method:Ht.GET,timeout:0,requestFormat:zt.FORM,responseFormat:Vt.TEXT,headers:{}};xhr=null;onError=new Rt;onResponse=new Rt;onStateChange=new Rt;onProgress=new Rt;constructor(t,e,n={}){this.cgi=t,this.data=e,this.option={...this.option,...n},this.option.method===Ht.GET&&this.data&&(this.cgi=Gt(this.cgi,this.data)),this.xhr=new XMLHttpRequest,this.xhr.open(this.option.method,this.cgi,!0),this.xhr.addEventListener("progress",(t=>{t.lengthComputable?this.onProgress.fire(t.loaded/t.total):this.onProgress.fire(null)})),this.xhr.onreadystatechange=()=>{this.onStateChange.fire(this.xhr.status)},this.xhr.addEventListener("load",(()=>{let t;if(n.responseFormat===Vt.JSON)try{t=JSON.parse(this.xhr.responseText)}catch(t){this.onError.fire("JSON解析失败："+t,this.xhr.status)}else t=this.xhr.responseText;this.onResponse.fire(t)})),this.xhr.addEventListener("error",(()=>{this.onError.fire(this.xhr.statusText,this.xhr.status)})),this.xhr.addEventListener("abort",(()=>{this.onError.fire("Request aborted.",509)})),this.xhr.setRequestHeader("content-type",qt[this.option.requestFormat]),this.xhr.setRequestHeader("Accept",Wt[this.option.responseFormat]);for(let t in this.option.headers)this.xhr.setRequestHeader(t,this.option.headers[t]);this.option.timeout&&setTimeout((()=>{this.xhr.abort(),this.onError.fire("Request timeout",508)}),this.option.timeout)}send(){let t=this.data?Bt[this.option.requestFormat](this.data):null;this.xhr.send(t)}abort(){this.xhr.abort()}static get(t,e,n={}){return n.method=n.method||Ht.GET,Xt.request(t,e,n)}static getJSON(t,e,n={}){return n.requestFormat=n.requestFormat||zt.JSON,n.responseFormat=n.responseFormat||Vt.JSON,Xt.get(t,e,n)}static post(t,e,n={}){return n.method=n.method||Ht.POST,Xt.request(t,e,n)}static postJSON(t,e,n={}){return n.requestFormat=n.requestFormat||zt.JSON,n.responseFormat=n.responseFormat||Vt.JSON,Xt.post(t,e,n)}static request(t,e,n={}){return new Promise(((i,o)=>{let r=new Xt(t,e,n);r.onResponse.listen((t=>{i(t)})),r.onError.listen((t=>{o(t)})),r.send()}))}}const Kt=(t,e)=>{e||(e=Pt(t)+"."+kt(t));let n=document.createElement("a");n.href=t,n.download=e,document.body.appendChild(n),n.click(),F(n)},Qt={parse(t){"?"===t[0]&&(t=t.substring(1));let e={};return t.split("&").forEach((t=>{let[n,i]=t.split("=");n.length&&(e[decodeURIComponent(n)]=decodeURIComponent(i))})),e},stringify(t){if(void 0===t||"object"!=typeof t)return t;let e=[];for(let n in t)if(t.hasOwnProperty(n)){if(null===t[n])continue;"object"==typeof t[n]&&t[n].length?t[n].forEach((t=>{e.push(encodeURI(n+"="+t))})):"object"==typeof t[n]||e.push(encodeURI(n+"="+t[n]))}return e.join("&")}},Zt=(t,e)=>{let n=Object.keys(t),i=Object.keys(e);return n.length===i.length&&Object.keys(t).every((n=>t[n]===e[n]))},te=t=>{let e=new Map;return t.filter((t=>{if(!e.has(t))return e.set(t,!0),!0}))},ee=(t,e,n)=>{if(!t||!t.length)return t;let i={};if(t.forEach((t=>{let n=t[e];i[n]||(i[n]=[]),i[n].push(t)})),!n)return i;let o=[];for(let t in i)o[t]=i[t][0];return o},ne=(t,e,n={},i=".")=>{let o,r,a=t.split(i),l=n;for(r=0;r<a.length-1;++r)o=a[r],l=l[o]=l[o]||{};return l[a[r]]=e},ie=(t,e,n={},i=0,o=[])=>{let r=(n=Object.assign({return_as_tree:!1,level_key:"tree_level",id_key:"id",parent_id_key:"parent_id",children_key:"children"},n)).parent_id_key,a=n.level_key,l=n.id_key,s=n.return_as_tree,c=n.children_key,d=[];return o=o.length?o:ee(e,r),e.forEach((h=>{if(h[r]===t){if(h[a]=i,n.return_as_tree||d.push(h),void 0!==h[l]&&void 0!==o[h[l]]&&o[h[l]]){let t=ie(h[l],e,n,i+1,o);t&&(s?h[c]=t:d=d.concat(...t))}s&&d.push(h)}})),d},oe=t=>{if(t.disabled)return null;if("INPUT"===t.tagName&&("radio"===t.type||"checkbox"===t.type))return t.checked?t.value:null;if("SELECT"===t.tagName&&t.multiple){let e=[];return z("option:checked",t).forEach((t=>{e.push(t.value)})),e}return t.value},re=(t,e,n)=>{ae(t).forEach((function(t){let i=t.name,o=oe(t);t.disabled=!0,e(i).then((e=>{t.disabled=!1,"radio"===t.type||"checkbox"===t.type?(t.checked=t.value==e,o=e):null!==e&&(t.value=e,o=e)})),t.addEventListener("change",(e=>{if(t.disabled=!0,!t.checkValidity())return void t.reportValidity();let i=t.value;"radio"!==t.type&&"checkbox"!==t.type||t.checked||(i=null),n(t.name,i).then((()=>{t.disabled=!1}),(()=>{"radio"===t.type||"checkbox"===t.type?t.checked=t.value==o:null!==o&&(t.value=o)}))}))}))},ae=(t,e=!1)=>{let n=t.querySelectorAll("input,textarea,select");return Array.from(n).filter((t=>!B(t)&&!t.disabled&&(e||t.name)))},le=(t,e=!1)=>{let n=ae(t,!e),i=!0;return Array.from(n).every((t=>!!t.checkValidity()||(t.reportValidity(),i=!1,!1))),i},se=(t,e=!0)=>{let n=ce(t,e),i=[];return n.forEach((t=>{let[e,n]=t;Array.isArray(n)?n.forEach((t=>{i.push(encodeURIComponent(e)+"="+encodeURIComponent(String(t)))})):i.push(encodeURIComponent(e)+"="+encodeURIComponent(String(n)))})),i.join("&")},ce=(t,e=!0)=>{if(e&&!le(t))return[];let n=ae(t),i=[];return n.forEach((t=>{let e=t.name,n=oe(t);null!==n&&i.push([e,n])})),i},de=(t,e=!0)=>{let n={},i=ce(t,e),o={};return i.forEach((t=>{let[e]=t;void 0===o[e]?o[e]=1:o[e]++})),i.forEach((t=>{let[e,i]=t;o[e]>1?void 0===n[e]?n[e]=[i]:n[e].push(i):n[e]=i})),n},he=(t,e,n=!0)=>{let i={};for(let o in t){let r=t[o],a=e[o];if(void 0!==a)switch(typeof a){case"string":i[o]=r;break;case"boolean":i[o]="1"===r||"true"===r;break;case"number":i[o]=parseInt(r,10);break;case"object":i[o]=r?JSON.parse(r):{};break;default:throw"format schema no supported"}else{if(n)continue;i[o]=r}}return i};let pe={},ue={},me={},ge=xt.Namespace+"form-unsaved-sid";const fe=t=>{let e=t.getAttribute(ge);if(!e)throw"Form no init by bindFormUnSavedAlert()";return!Zt(pe[e],ue[e])&&me[e]},be=t=>{let e=t.getAttribute(ge);if(!e)throw"Form no init by bindFormUnSavedAlert()";pe[e]=ue[e]=de(t,!1)},ve=(t,e=["1","0"])=>{let n={};for(let i in t){let o=t[i];switch(typeof o){case"string":case"number":n[i]=String(o);break;case"boolean":n[i]=o?e[0]:e[1];break;case"object":n[i]=JSON.stringify(o);break;default:throw"format schema no supported"}}return n},we="data-submitting";class $e{static REQUEST_FORMAT=zt.JSON;static COMMON_SUCCESS_RESPONSE_HANDLE=t=>{let e=()=>{t.forward_url?parent.location.href=t.forward_url:parent.location.reload()};if(t.message){let n=Ot.DEFAULT_TIME_MAP[Ot.TYPE_SUCCESS];Ot.showToast(t.message,Ot.TYPE_SUCCESS,n),setTimeout(e,Math.max(n-500,0))}else e()};static active(t,e={},n=null){return new Promise(((i,o)=>{if(t.getAttribute(we))return;let r,a,l,s=$e.COMMON_SUCCESS_RESPONSE_HANDLE,c=null;e.onsuccess&&(s="string"==typeof e.onsuccess?window[e.onsuccess]:e.onsuccess),"FORM"===t.tagName?(r=((t,e=null)=>e&&e.submitter&&e.submitter.formAction?e.submitter.formAction:t.action)(t,n),c=n.submitter,a=$e.REQUEST_FORMAT===zt.JSON?de(t):se(t),l="post"===t.method.toLowerCase()?"post":"get"):"A"===t.tagName&&(r=t.href,l="get"),r=e.url||r,l=e.method||l||"get",a=e.data||a;let d=Ot.showLoadingLater("正在请求中，请稍候···");t.setAttribute(we,"1"),c&&c.setAttribute(we,"1"),Yt(r,a,l,{requestFormat:$e.REQUEST_FORMAT}).then((t=>{0===t.code?(s(t),i()):(console.error("Request Error:",r,a,l,t),Ot.showError(t.message||"系统错误"),o(`系统错误(${t.message})`))}),(t=>{Ot.showError(t),o(t)})).finally((()=>{t.removeAttribute(we),c&&c.removeAttribute(we),d&&d.hide()}))}))}}const ye=xt.Namespace+"dialog",Ee=ye,xe=Ee+"-ti",Ae=Ee+"-ctn",_e=Ee+"-op",Te=Ee+"-close",Ce=Ee+"-btn",Le=Ee+"-weak-btn",Se="data-dialog-flag",Ne="active",Ie="disabled",Oe="hidden",ke="data-dialog-type",Pe="prompt",Re="confirm",Me=Ee+"-ctn-iframe",De=Ee+"-ctn-html";K(`\n\t.${Ee} {border:none; margin:auto !important; padding:0 !important; /** 原生浏览器有1em内边距 **/ border-radius:var(${xt.CssVar.PANEL_RADIUS}); overflow:auto; min-width:1em; box-sizing:border-box; background-color:var(${xt.CssVar.BACKGROUND_COLOR}); color:var(${xt.CssVar.COLOR});}\n\t.${Ee} {position:fixed;inset-block-start: 0px;inset-block-end: 0px;}\n\t.${Ee}:focus {outline:none}\n\t.${Ee}[data-transparent] {background-color:transparent !important; box-shadow:none !important}\n\t.${Ee} .${Ee}-ti {user-select:none; box-sizing:border-box; line-height:1; padding:0.75em 2.5em 0.75em 0.75em; font-weight:normal;color:var(${xt.CssVar.CSS_LIGHTEN})}\n\t.${Ee} .${Te} {position:absolute; display:flex; align-items:center; line-height:1; width:2.25em; height:2.5em; overflow:hidden; opacity:0.6; cursor:pointer; right:0; top:0;box-sizing:border-box; text-align:center;}\n\t.${Ee} .${Te}:after {content:"\\e61a"; font-size:0.9em; font-family:${xt.IconFont}; line-height:1; display:block; flex:1}\n\t.${Ee} .${Te}:hover {opacity:1;}\n\t.${Ee} .${Ae} {overflow-y:auto; max-height:calc(100vh - 6em)}\n\t.${Ee} .${Ae}:focus {outline:none !important;}\n\t.${Ee} .${_e} {padding:.75em; text-align:right;}\n\t.${Ee} .${Ce}:first-child {margin-left:0;}\n\t.${Ee} .${Ce} {margin-left:0.5em;}\n\t.${Ee}.full-dialog .${Ae} {max-height:calc(100vh - 100px); overflow-y:auto}\n\t.${Ee}[data-dialog-state="${Ne}"] {box-shadow:1px 1px 60px 1px #44444457}\n\t.${Ee}[data-dialog-state="${Ne}"] .dialog-ti {color:#333}\n\t.${Ee}[data-dialog-state="${Ie}"]:before {content:""; left:0; top:0; position:absolute; width:100%; height:100%;}\n\t.${Ee}[data-dialog-state="${Ie}"] * {opacity:0.85 !important; user-select:none;}\n\t\n\t.${Ee}[${ke}="${Re}"] .${Ae} {padding:1.5em 1.5em 1em 1.5em; min-height:40px;}\n\t.${Ee}[${ke}="${Re}"] .${Ee}-confirm-ti {font-size:1.2em; margin-bottom:.75em;}\n\t.${Ee}[${ke}="${Pe}"] .${Ae} {padding:2em 2em 1em 2em}\n\t.${Ee}[${ke}="${Pe}"] .${Ae} label {font-size:1.1em; margin-bottom:.75em; display:block;}\n\t.${Ee}[${ke}="${Pe}"] .${Ae} input[type=text] {width:100%; box-sizing:border-box;}\n\t\n\t.${Ee} .${Ae}-iframe {padding:0 !important}\n\t.${Ee} .${Ae}-iframe iframe {width:100%; border:none; display:block; min-height:30px;}\n\t.${Ee}::backdrop {backdrop-filter:brightness(0.65)}\n`,ye+"-style"),document.addEventListener("keydown",(t=>{if(t.keyCode===Ut.Esc){let e=Ge.getFrontDialog();e&&e.config.showTopCloseButton&&(Ge.close(e),t.stopImmediatePropagation())}}));let Fe=[];const Ue=(t,e)=>t.zIndex-e.zIndex,He=(t=null)=>Fe.filter((e=>e.state!==Oe&&e.config.modal&&(!t||e!==t))).sort(Ue),ze=(t=null)=>Fe.filter((e=>!(e.state===Oe||e.config.modal||t&&e===t))).sort(Ue),qe=(t=null)=>{let e=He(t);return ze(t).concat(e)},Be=(t,e)=>{t.state=e,t.dom.setAttribute("data-dialog-state",e),t.dom[e===Oe?"hide":t.config.modal?"showModal":"show"]()},Ve=(t,e)=>{t.zIndex=t.dom.style.zIndex=String(e)},We=(t,e)=>{t.dom.setAttribute("data-dialog-type",e)},Ge={register(t){Fe.push(t)},show(t){t.state=Ie;let e=He(t),n=ze(t);t.config.modal?(n.forEach((t=>{Be(t,Ie)})),e.forEach((t=>{Be(t,Ie)})),Ve(t,Ke.DIALOG_INIT_Z_INDEX+n.length+e.length),Be(t,Ne)):(e.forEach(((e,n)=>{Ve(e,t.zIndex+n+1)})),Ve(t,Ke.DIALOG_INIT_Z_INDEX+n.length),Be(t,e.length?Ie:Ne)),t.onShow.fire()},close:(t,e=!0)=>{if(!1===t.onClose.fire())return console.warn("dialog close cancel by onClose events"),!1;let n=He(t),i=ze(t);n.forEach(((t,e)=>{Ve(t,Ke.DIALOG_INIT_Z_INDEX+i.length+e)})),n.length&&Be(n[n.length-1],Ne),i.forEach(((t,e)=>{Ve(t,Ke.DIALOG_INIT_Z_INDEX+e),Be(t,n.length?Ie:Ne)})),e?(Fe=Fe.filter((e=>e!==t)),F(t.dom)):Be(t,Oe),qe().length||t.dom.classList.remove(`${Ee}-masker`)},hide(t){return this.close(t,!1)},getFrontDialog(){let t=qe();return t[t.length-1]},trySetFront(t){let e=He();if(this.getFrontDialog()===t)return!0;if(e.length)return!1;let n=ze(t);n.forEach(((t,e)=>{Ve(t,Ke.DIALOG_INIT_Z_INDEX+e)})),Ve(t,Ke.DIALOG_INIT_Z_INDEX+n.length)},closeAll(){Fe.forEach((t=>{F(t.dom)})),Fe=[]},findById:t=>Fe.find((e=>e.id===t))},je=t=>"object"==typeof t&&t.src?Me:De,Ye=t=>{let e=`\n\t\t<dialog class="${Ee}" \n\t\t\tid="${t.id}" \n\t\t\tdata-dialog-type="normal"\n\t\t\t${t.config.transparent?"data-transparent":""}\n\t\t\t${t.state===Oe?"":"open"} \n\t\t\tstyle="${t.config.width?"width:"+w(t.config.width):""}">\n\t\t${t.config.title?`<div class="${xe}">${t.config.title}</div>`:""}\n\t`;if(e+=`<div class="${Ae} ${je(t.config.content)}" \n\t\t\tstyle="min-height: ${w(Ke.CONTENT_MIN_HEIGHT)}; ${t.config.height?"height:"+w(t.config.height)+";":""}" \n\t\t\ttabindex="0">${Je(t)}</div>`,t.config.buttons.length&&(e+=`<div class="${_e}">`,t.config.buttons.forEach((t=>{e+=`<input type="button" class="${Ce} ${t.className||""}" ${t.default?"autofocus":""} tabindex="0" value="${E(t.title)}">`})),e+="</div>"),e+=t.config.showTopCloseButton?`<span class="${Te}" title="关闭" tabindex="0"></span>`:"",e+="</dialog>",t.dom=nt(e,document.body),je(t.config.content)===Me){(t=>{let e;try{let n=()=>{let e=t.contentWindow.document.body;e&&(t.style.height=w(e.scrollHeight||e.clientHeight||e.offsetHeight))};t.addEventListener("load",(()=>{e=new MutationObserver(n),e.observe(t.contentWindow.document.body,{attributes:!0,subtree:!0,childList:!0}),n()}))}catch(t){try{e&&e.disconnect()}catch(t){console.error("observer disconnect fail",t)}console.warn("iframe content upd",t)}})(t.dom.querySelector("iframe"))}},Je=t=>{switch(je(t.config.content)){case Me:return`<iframe src="${t.config.content.src}" ${Se}="${t.id}"></iframe>`;case De:return t.config.content;default:throw console.error("Content type error",t.config.content),"Content type error"}},Xe={};class Ke{static CONTENT_MIN_HEIGHT=30;static DEFAULT_WIDTH=500;static DIALOG_INIT_Z_INDEX=xt.DialogIndex;id=null;dom=null;state=Oe;zIndex=xt.DialogIndex;onClose=new Rt(!0);onShow=new Rt(!0);config={title:"",content:"",modal:!0,transparent:!1,width:Ke.DEFAULT_WIDTH,height:null,buttons:[],showTopCloseButton:!0};constructor(t={}){this.config=Object.assign(this.config,t),this.id=this.id||"dialog-"+Math.random(),Ye(this),(t=>{t.dom.addEventListener("mousedown",(()=>{t.state===Ne&&Ge.trySetFront(t)})),t.dom.addEventListener("cancel",(t=>{t.preventDefault()}));for(let e in t.config.buttons){let n=t.config.buttons[e].callback||t.close;t.dom.querySelectorAll(`.${_e} .${Ce}`)[e].addEventListener("click",n.bind(t),!1)}if(t.config.showTopCloseButton){let e=t.dom.querySelector(`.${Te}`);Mt(e,t.close.bind(t))}})(this),Ge.register(this)}show(){Ge.show(this)}hide(){Ge.hide(this)}close(){Ge.close(this)}fireCustomEvent(t,...e){return!(!Xe[this.id]||!Xe[this.id][t])&&(Xe[this.id][t].fire(...e),!0)}listenCustomEvent(t,e){void 0===Xe[this.id]&&(Xe[this.id]={}),void 0===Xe[this.id][t]&&(Xe[this.id][t]=new Rt),Xe[this.id][t].listen(e)}static show(t,e,n){let i=new Ke({title:t,content:e,...n});return i.show(),i}static confirm(t,e,n={}){return new Promise(((i,o)=>{let r=new Ke({content:`<div class="${Ee}-confirm-ti">${t}</div>\n\t\t\t\t\t\t<div class="${Ee}-confirm-ctn">${e}</div>`,buttons:[{title:"确定",default:!0,callback:()=>{r.close(),i()}},{title:"取消",className:Le,callback:()=>{r.close(),o&&o()}}],width:420,modal:!0,showTopCloseButton:!1,...n});We(r,Re),r.show()}))}static alert(t,e,n={}){return new Promise((i=>{let o=new Ke({content:`<div class="${Ee}-confirm-ti">${t}</div>\n\t\t\t\t\t\t<div class="${Ee}-confirm-ctn">${e}</div>`,buttons:[{title:"确定",default:!0,callback:()=>{o.close(),i()}}],width:420,modal:!0,showTopCloseButton:!1,...n});We(o,Re),o.show()}))}static iframe(t=null,e,n={}){return Ke.show(t,{src:e},n)}static prompt(t,e={initValue:""}){return new Promise(((n,i)=>{let o=_(xt.Namespace+"-prompt-input"),r=null,a=new Ke({content:`<label for="${o}">${t}</label><input type="text" id="${o}" value="${E(e.initValue||"")}"/>`,buttons:[{title:"确定",default:!0,callback:()=>{if(!1===n(r.value))return!1;a.close()}},{title:"取消",className:Le}],width:400,modal:!0,showTopCloseButton:!0,...e});r=a.dom.querySelector("input[type=text]"),We(a,Pe),a.onClose.listen(i),a.onShow.listen((()=>{r.focus(),r.addEventListener("keydown",(t=>{if(t.keyCode===Ut.Enter){if(!1===n(r.value))return!1;a.close()}}))})),a.show()}))}}window[ye]||(window[ye]={}),window[ye].Dialog=Ke,window[ye].DialogManager=Ge;let Qe=lt(),Ze=Qe[ye].Dialog||Ke,tn=Qe[ye].DialogManager||Ge;class en{static active(t,e={}){return new Promise(((n,i)=>{let o,r,a;"A"===t.tagName&&(r=t.href||r,o=t.title||o),t.innerText&&(o=l(t.innerText,30)),o=e.title||o,r=e.url||r,a=e.content||a,r&&(a={src:r}),Ze.show(o||"对话框",a,e),n()}))}}class nn{static active(t,e={}){return new Promise(((t,n)=>{let i=e.title,o=e.message;Ze.confirm(i||"确认",o).then(t,n)}))}}const on=xt.Namespace+"-tip-guid",rn=xt.Namespace+"tip",an=[11,0,1,2,3,4,5,6,7,8,9,10];let ln={};K(`\n\t.${rn}-container-wrap {position:absolute; filter:drop-shadow(var(${xt.CssVar.PANEL_SHADOW})); --tip-arrow-size:10px; --tip-gap:calc(var(--tip-arrow-size) * 0.7071067811865476); --tip-mgr:calc(var(--tip-gap) - var(--tip-arrow-size) / 2); color:var(${xt.CssVar.COLOR}); z-index:${xt.TipIndex};}\n\t.${rn}-arrow {display:block; background-color:var(${xt.CssVar.BACKGROUND_COLOR}); clip-path:polygon(0% 0%, 100% 100%, 0% 100%); width:var(--tip-arrow-size); height:var(--tip-arrow-size); position:absolute; z-index:1}\n\t.${rn}-close {display:block; overflow:hidden; width:15px; height:20px; position:absolute; right:7px; top:10px; text-align:center; cursor:pointer; font-size:13px; opacity:.5}\n\t.${rn}-close:hover {opacity:1}\n\t.${rn}-content {border-radius:var(${xt.CssVar.PANEL_RADIUS}); background-color:var(${xt.CssVar.BACKGROUND_COLOR}); padding:1em;  max-width:30em; word-break:break-all}\n\t\n\t/** top **/\n\t.${rn}-container-wrap[data-tip-dir="11"],\n\t.${rn}-container-wrap[data-tip-dir="0"],\n\t.${rn}-container-wrap[data-tip-dir="1"]{padding-top:var(--tip-gap)}\n\t.${rn}-container-wrap[data-tip-dir="11"] .${rn}-arrow,\n\t.${rn}-container-wrap[data-tip-dir="0"] .${rn}-arrow,\n\t.${rn}-container-wrap[data-tip-dir="1"] .${rn}-arrow{top:var(--tip-mgr); transform:rotate(135deg);}\n\t.${rn}-container-wrap[data-tip-dir="11"] .${rn}-arrow{left:calc(25% - var(--tip-gap));}\n\t.${rn}-container-wrap[data-tip-dir="0"] .${rn}-arrow{left:calc(50% - var(--tip-gap));background:orange;}\n\t.${rn}-container-wrap[data-tip-dir="1"] .${rn}-arrow{left:calc(75% - var(--tip-gap));}\n\t\n\t/** left **/\n\t.${rn}-container-wrap[data-tip-dir="8"],\n\t.${rn}-container-wrap[data-tip-dir="9"],\n\t.${rn}-container-wrap[data-tip-dir="10"]{padding-left:var(--tip-gap)}\n\t.${rn}-container-wrap[data-tip-dir="8"] .${rn}-close,\n\t.${rn}-container-wrap[data-tip-dir="9"] .${rn}-close,\n\t.${rn}-container-wrap[data-tip-dir="10"] .${rn}-close{top:3px;}\n\t.${rn}-container-wrap[data-tip-dir="8"] .${rn}-arrow,\n\t.${rn}-container-wrap[data-tip-dir="9"] .${rn}-arrow,\n\t.${rn}-container-wrap[data-tip-dir="10"] .${rn}-arrow{left:var(--tip-mgr); transform:rotate(45deg);}\n\t.${rn}-container-wrap[data-tip-dir="8"] .${rn}-arrow{top:calc(75% - var(--tip-gap));}\n\t.${rn}-container-wrap[data-tip-dir="9"] .${rn}-arrow{top:calc(50% - var(--tip-gap));}\n\t.${rn}-container-wrap[data-tip-dir="10"] .${rn}-arrow{top:calc(25% - var(--tip-gap));}\n\t\n\t/** bottom **/\n\t.${rn}-container-wrap[data-tip-dir="5"],\n\t.${rn}-container-wrap[data-tip-dir="6"],\n\t.${rn}-container-wrap[data-tip-dir="7"]{padding-bottom:var(--tip-gap)}\n\t.${rn}-container-wrap[data-tip-dir="5"] .${rn}-close,\n\t.${rn}-container-wrap[data-tip-dir="6"] .${rn}-close,\n\t.${rn}-container-wrap[data-tip-dir="7"] .${rn}-close{top:3px;}\n\t.${rn}-container-wrap[data-tip-dir="5"] .${rn}-arrow,\n\t.${rn}-container-wrap[data-tip-dir="6"] .${rn}-arrow,\n\t.${rn}-container-wrap[data-tip-dir="7"] .${rn}-arrow{bottom:var(--tip-mgr); transform:rotate(-45deg);}\n\t.${rn}-container-wrap[data-tip-dir="5"] .${rn}-arrow{right: calc(25% - var(--tip-gap));}\n\t.${rn}-container-wrap[data-tip-dir="6"] .${rn}-arrow{right: calc(50% - var(--tip-gap));}\n\t.${rn}-container-wrap[data-tip-dir="7"] .${rn}-arrow{right: calc(75% - var(--tip-gap));}\n\t\n\t/** right **/\n\t.${rn}-container-wrap[data-tip-dir="2"],\n\t.${rn}-container-wrap[data-tip-dir="3"],\n\t.${rn}-container-wrap[data-tip-dir="4"]{padding-right:var(--tip-gap)}\n\t.${rn}-container-wrap[data-tip-dir="2"] .${rn}-close,\n\t.${rn}-container-wrap[data-tip-dir="3"] .${rn}-close,\n\t.${rn}-container-wrap[data-tip-dir="4"] .${rn}-close{right:13px;top:3px;}\n\t.${rn}-container-wrap[data-tip-dir="2"] .${rn}-arrow,\n\t.${rn}-container-wrap[data-tip-dir="3"] .${rn}-arrow,\n\t.${rn}-container-wrap[data-tip-dir="4"] .${rn}-arrow{right:var(--tip-mgr);transform: rotate(-135deg);}\n\t.${rn}-container-wrap[data-tip-dir="2"] .${rn}-arrow{top:calc(25% - var(--tip-gap))}\n\t.${rn}-container-wrap[data-tip-dir="3"] .${rn}-arrow{top:calc(50% - var(--tip-gap));}\n\t.${rn}-container-wrap[data-tip-dir="4"] .${rn}-arrow{top:calc(75% - var(--tip-gap))}\n`,xt.Namespace+"tip-style");let sn=function(t,e,n,i,o){return{11:[.25*-e+o/2,i],0:[.5*-e+o/2,i],1:[.75*-e+o/2,i],2:[-e,.25*-n+i/2],3:[-e,.5*-n+i/2],4:[-e,.75*-n+i/2],5:[.75*-e+o/2,-n],6:[.5*-e+o/2,-n],7:[.25*-e+o/2,-n],8:[o,.75*-n+i/2],9:[o,.5*-n+i/2],10:[o,.25*-n+i/2]}[t]};const cn=t=>{let e=t.option.direction,n=t.dom.offsetWidth,i=t.dom.offsetHeight,o=q(t.relateNode),r=t.relateNode.offsetHeight,a=t.relateNode.offsetWidth;"auto"===e&&(e=(t=>{let e=t.dom.offsetWidth,n=t.dom.offsetHeight,i=t.relateNode.offsetHeight,o=t.relateNode.offsetWidth,r=q(t.relateNode),a=Q();for(let t=0;t<an.length;t++){let[l,s]=sn(an[t],e,n,i,o),c={left:r.left+l,top:r.top+s,width:e,height:n},d={left:document.body.scrollLeft,top:document.body.scrollTop,width:a.visibleWidth,height:a.visibleHeight};if(Z(c,d))return an[t]}return 11})(t)),t.dom.setAttribute("data-tip-dir",e);let[l,s]=sn(e,n,i,r,a);t.dom.style.left=w(o.left+l),t.dom.style.top=w(o.top+s)};class dn{id=null;relateNode=null;dom=null;option={showCloseButton:!0,width:"auto",direction:"auto"};onShow=new Rt(!0);onHide=new Rt(!0);onDestroy=new Rt(!0);constructor(t,e,n={}){var i;this.id=_(),this.relateNode=e,this.option=Object.assign(this.option,n),this.dom=nt(`<div class="${rn}-container-wrap" style="display:none; ${this.option.width?"width:"+w(this.option.width):""}">\n\t\t\t\t<s class="${rn}-arrow"></s>\n\t\t\t\t${this.option.showCloseButton?`<span class="${rn}-close">&#10005;</span>`:""}\n\t\t\t\t<div class="${rn}-content">${t}</div>\n\t\t\t</div>`),(i=this).option.showCloseButton&&(i.dom.querySelector(`.${rn}-close`).addEventListener("click",(()=>{i.hide()}),!1),document.addEventListener("keyup",(t=>{t.keyCode===Ut.Esc&&i.hide()}),!1)),ln[this.id]=this}setContent(t){this.dom.querySelector(`.${rn}-content`).innerHTML=t,cn(this)}show(){document.contains(this.dom)||document.body.appendChild(this.dom),U(this.dom),cn(this),this.onShow.fire(this)}hide(){D(this.dom),this.onHide.fire(this)}destroy(){F(this.dom),this.onDestroy.fire();for(let t in ln)ln[t]===this&&delete ln[t]}static show(t,e,n={}){let i=new dn(t,e,n);return i.show(),i}static hideAll(){for(let t in ln)ln[t].hide()}static bindNode(t,e,n={triggerType:"hover"}){let i=e.getAttribute(on),o=ln[i];if(!o){o=new dn(t,e,n),e.setAttribute(on,o.id);let i=null,r=()=>{i&&clearTimeout(i),i=setTimeout((()=>{o.hide()}),10)},a=()=>{i&&clearTimeout(i),o.show()};switch(n.triggerType){case"hover":e.addEventListener("mouseover",a),e.addEventListener("mouseout",r),o.dom.addEventListener("mouseout",r),o.dom.addEventListener("mouseover",a);break;case"click":e.addEventListener("click",(()=>{"none"!==o.dom.style.display?r():a()})),document.addEventListener("click",(t=>{V(e,t.target,!0)||V(o.dom,t.target,!0)||r()}));break;default:throw"option.triggerType no supported:"+n.triggerType}}return o}static bindAsync(t,e,n={}){let i=t.getAttribute(`data-${on}`),o=ln[i];if(!o){let i=!1;o=dn.bindNode("loading...",t,n),o.onShow.listen((()=>{i||(i=!0,e().then((t=>{o.setContent(t)}),(t=>{o.setContent(t)})).finally((()=>{i=!1})))}))}}}class hn{static init(t,e){let{content:n,triggertype:i="hover"}=e;return new Promise(((e,o)=>{!n&&t.title&&(n=t.title,t.title=""),n?(dn.bindNode(n,t,{triggerType:i}),e()):o("content required")}))}}const pn=(t,e="default")=>t,un=(t,e=!1)=>{let n=nt('<textarea readonly="readonly">',document.body);n.style.cssText="position:absolute; left:-9999px;";let i=window.pageYOffset||document.documentElement.scrollTop;n.addEventListener("focus",(function(){window.scrollTo(0,i)})),n.value=t,n.select();try{let t=document.execCommand("copy");return!e&&Ot.showSuccess(pn("复制成功")),t}catch(e){console.error(e),Ze.prompt("复制失败，请手工复制",{initValue:t})}finally{F(n)}return!1},mn=(t,e=!1)=>{let n=nt(`\n\t\t<div style="position:fixed; pointer-events:none; opacity:0;">${t}</div>\n\t`,document.body),i=Array.prototype.slice.call(document.styleSheets).filter((function(t){return!t.disabled}));window.getSelection().removeAllRanges();let o=document.createRange();o.selectNode(n),window.getSelection().addRange(o),document.execCommand("copy");for(let t=0;t<i.length;t++)i[t].disabled=!0;document.execCommand("copy");for(let t=0;t<i.length;t++)i[t].disabled=!1;document.body.removeChild(n),!e&&Ot.showSuccess(pn("复制成功"))};class gn{static active(t,e={}){return new Promise(((t,n)=>{if(!e.content)throw"复制内容为空";"html"===e.type?mn(e.content):un(e.content),t()}))}}class fn{static active(t,e={}){return new Promise(((t,n)=>{let i=e.message||"提示信息",o=e.type||Ot.TYPE_INFO;Ot.showToast(i,o,Ot.DEFAULT_TIME_MAP[o],t)}))}}const bn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",vn=async t=>await wn(t),wn=t=>new Promise(((e,n)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(i.result),i.onerror=t=>n(t)})),$n=t=>new Promise(((e,n)=>{let i=new Image;i.onload=()=>{e(i)},i.onabort=()=>{n("Image loading abort")},i.onerror=()=>{n("Image load failure")},i.src=t})),yn=t=>t.split(",").reduce(((t,e)=>{let[n,i]=e.trim().split(" ");return i=parseInt(i),i>t.width?{width:i,url:n}:t}),{width:0,url:""}).url,En=t=>null===t?null:JSON.parse(t);let xn=[],An=(t,e,n)=>{xn.forEach((i=>{i(t,e,n)}))},_n=!1;class Tn{namespace="";settingKeys=[];constructor(t,e=""){this.namespace=e,this.settingKeys=Object.keys(t);for(let e in t){null===this.get(e)&&this.set(e,t[e])}}get(t){let e=localStorage.getItem(this.namespace+t);return null===e?null:En(e)}set(t,e){var n;An(t,e,this.get(t)),localStorage.setItem(this.namespace+t,(n=e,JSON.stringify(n)))}remove(t){An(t,null,this.get(t)),localStorage.removeItem(this.namespace+t)}onUpdated(t){xn.push(t),_n||(_n=!0,window.addEventListener("storage",(t=>{this.namespace&&0!==t.key.indexOf(this.namespace)||An(t.key.substring(this.namespace.length),En(t.newValue),En(t.oldValue))})))}each(t){this.settingKeys.forEach((e=>{t(e,this.get(e))}))}removeAll(){this.settingKeys.forEach((t=>{this.remove(t)}))}getAll(){let t={};return this.settingKeys.forEach((e=>{t[e]=this.get(e)})),t}}const Cn=xt.Namespace+"com-image-viewer",Ln=lt();Ln[Cn]||(Ln[Cn]={});const Sn=Cn,Nn="data-original-width",In="data-original-height",On="data-disabled",kn=xt.FullScreenModeIndex,Pn=kn+1,Rn=kn+2;let Mn=null,Dn=0;const Fn=["close","关闭",()=>{ni()}],Un=["nav_to","关闭",t=>{di("1"!==t.getAttribute("data-dir"))}],Hn=["switch_to","关闭",t=>{hi(t.getAttribute("data-index"))}],zn=["thumb_scroll_prev","关闭",()=>{pi(!0)}],qn=["thumb_scroll_next","关闭",()=>{pi(!1)}],Bn=["zoom_out","放大",()=>(mi(1.2),!1)],Vn=["zoom_in","缩小",()=>(mi(.8),!1)],Wn=["zoom_org","原始比例",()=>(mi(null),!1)],Gn=["rotate_left","左旋90°",()=>(gi(-90),!1)],jn=["rotate_right","右旋90°",()=>(gi(90),!1)],Yn=["view_org","查看原图",()=>{fi()}],Jn=["download","下载图片",()=>{Kt(ei(Kn[Qn]).original)}],Xn=["option","选项",()=>{bi()}];let Kn=[],Qn=0;const Zn={mouse_scroll_type:2,allow_move:!0,show_thumb_list:!1,show_toolbar:!0};let ti=new Tn(Zn,xt.Namespace+"com-image-viewer/");const ei=t=>({thumb:(t="string"==typeof t?[t]:t)[0],normal:t[1]||t[0],original:t[2]||t[1]||t[0]});K(`\n\t @keyframes ${xt.Namespace}spin{\n\t\t100%{transform:rotate(360deg);}\n\t}\n\t.${Sn}{width:100vw;height:100vh; max-height:100vh !important; max-width:100vw !important; overflow:hidden; padding:0; margin:0; border:none; background-color:#fff0;}\n\t.${Sn}::backdrop {backdrop-filter:brightness(0.65) blur(10px)}\n\t.${Sn} .civ-closer{position:fixed; opacity:0.7; z-index:${Pn}; background-color:#cccccc87; color:white; right:20px; top:20px; border-radius:3px; cursor:pointer; font-size:0; line-height:1; padding:5px;}\n\t.${Sn} .civ-closer:before{font-family:"${xt.IconFont}", serif; content:"\\e61a"; font-size:20px;}\n\t.${Sn} .civ-closer:hover{opacity:1}\n\t.${Sn} .civ-nav-btn{padding:10px; z-index:${Pn}; transition:all 0.1s linear; border-radius:3px; opacity:0.8; color:white; background-color:#8d8d8d6e; position:fixed; top:calc(50% - 25px); cursor:pointer;}\n\t.${Sn} .civ-nav-btn[disabled]{color:gray; cursor:default !important;}\n\t.${Sn} .civ-nav-btn:not([disabled]):hover{opacity:1;}\n\t.${Sn} .civ-nav-btn:before{font-family:"${xt.IconFont}"; font-size:20px;}\n\t.${Sn} .civ-prev{left:10px}\n\t.${Sn} .civ-prev:before{content:"\\e6103"}\n\t.${Sn} .civ-next{right:10px}\n\t.${Sn} .civ-next:before{content:"\\e73b";}\n\n\t.${Sn} .civ-view-option {position:fixed;display:flex;--opt-btn-size:1.8rem;background-color: #6f6f6f26;backdrop-filter:blur(4px);padding:0.25em 0.5em;left:50%;transform:translate(-50%, 0);z-index:${Pn};gap: 0.5em;border-radius:4px;}\n\t.${Sn} .civ-opt-btn {cursor:pointer;flex:1;user-select:none;width: var(--opt-btn-size); line-height:1; height:var(--opt-btn-size);overflow: hidden; color: white;padding: 0.2em;border-radius: 4px;transition: all 0.1s linear;opacity: 0.7;}\n\t.${Sn} .civ-opt-btn:before {font-family:"${xt.IconFont}";font-size:var(--opt-btn-size);display: block;width: 100%;height: 100%;}\n\t.${Sn} .civ-opt-btn:hover {background-color: #ffffff3b;opacity: 1;}\n\t\n\t.${Sn}-icon:before {content:""; font-family:"${xt.IconFont}"; font-style:normal;}\n\t.${Sn}-icon-${Bn[0]}:before {content: "\\e898";}\n\t.${Sn}-icon-${Vn[0]}:before {content:"\\e683"} \n\t.${Sn}-icon-${Wn[0]}:before {content:"\\e64a"} \n\t.${Sn}-icon-${Gn[0]}:before {content:"\\e7be"} \n\t.${Sn}-icon-${jn[0]}:before {content:"\\e901"} \n\t.${Sn}-icon-${Yn[0]}:before {content:"\\e7de"} \n\t.${Sn}-icon-${Jn[0]}:before {content:"\\e839"} \n\t.${Sn}-icon-${Xn[0]}:before {content:"\\e9cb";}\n\n\t.${Sn} .civ-nav-wrap{position:fixed;opacity: 0.8;transition:all 0.1s linear;background-color: #ffffff26;bottom:10px;left:50%;transform:translate(-50%, 0);z-index:${Pn};display: flex; padding:0.5em 0.25em;max-width: min(calc(100vw - 200px), 600px);min-width: 100px;border-radius: 5px;backdrop-filter: blur(4px);box-shadow: 1px 1px 30px #6666666b;}\n\t.${Sn} .civ-nav-wrap:hover {opacity:1}\n\t.${Sn} .civ-nav-list-wrap {overflow:hidden; scroll-behavior: smooth;}\n\t.${Sn} .civ-nav-list-prev,\n\t.${Sn} .civ-nav-list-next {color:white; flex: 1; min-width:25px;cursor: pointer;opacity: 0.5;line-height: 48px;transition: all 0.1s linear; display: flex; align-items: center;}\n\t.${Sn} .civ-nav-list-prev:hover,\n\t.${Sn} .civ-nav-list-next:hover {opacity:1}\n\t.${Sn} .civ-nav-list-prev:before,\n\t.${Sn} .civ-nav-list-next:before{font-family:"${xt.IconFont}";font-size:18px;}\n\t.${Sn} .civ-nav-list-prev {}\n\t.${Sn} .civ-nav-list-next {right: -20px;}\n\t.${Sn} .civ-nav-list-prev:before{content:"\\e6103"}\n\t.${Sn} .civ-nav-list-next:before{content:"\\e73b";}\n\t\n\t.${Sn} .civ-nav-list{height:60px; transition:margin 0.4s ease-out; display:flex}\n\t.${Sn} .civ-nav-thumb{min-width:60px; height:100%; flex:1; transition:all 0.1s linear;overflow:hidden; box-sizing:border-box; cursor: pointer;}\n\t.${Sn} .civ-nav-thumb img{border:4px solid transparent; border-radius:3px; width:60px; height:60px; object-fit:cover; opacity: 0.6; box-sizing:border-box;}\n\t.${Sn} .civ-nav-thumb:hover img {border-color:#ffffff82;opacity:0.8;}\n\t.${Sn} .civ-nav-thumb.active img {border-color:white;opacity: 1;}\n\n\t.${Sn} .civ-ctn{height:100%; width:100%; position:absolute; top:0; left:0;}\n\t.${Sn} .civ-error{margin-top:calc(50% - 60px);}\n\t.${Sn} .civ-loading{--loading-size:50px; position:absolute; left:50%; top:50%; margin:calc(var(--loading-size) / 2) 0 0 calc(var(--loading-size) / 2)}\n\t.${Sn} .civ-loading:before{content:"\\e635"; font-family:"${xt.IconFont}" !important; animation:${xt.Namespace}spin 3s infinite linear; font-size:var(--loading-size); color:#ffffff6e; display:block; width:var(--loading-size); height:var(--loading-size); line-height:var(--loading-size)}\n\t.${Sn} .civ-img{height:100%; display:block; box-sizing:border-box; position:relative;}\n\t.${Sn} .civ-img img{position:absolute; left:50%; top:50%; transition:width 0.1s, height 0.1s, transform 0.1s; transform:translate(-50%, -50%); box-shadow:1px 1px 20px #484848; background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUAQMAAAC3R49OAAAABlBMVEXv7+////9mUzfqAAAAFElEQVQIW2NksN/ISAz+f9CBGAwAxtEddZlnB4IAAAAASUVORK5CYII=')}\n\n\t.${Sn}[data-ip-mode="1"] .civ-nav-btn,\n\t.${Sn}[data-ip-mode="1"] .civ-nav-wrap{display:none;}\n\n\t.${Sn}-option-list {padding: 1em 2em 2em;display: block;list-style: none;font-size:1rem;}\n\t.${Sn}-option-list>li {margin-bottom: 1em;padding-left: 5em;}\n\t.${Sn}-option-list>li:last-child {margin:0;}\n\t.${Sn}-option-list>li>label:first-child {display:block;float: left;width: 5em;margin-left: -5em;user-select:none;}\n\t.${Sn}-option-list>li>label:not(:first-child) {display:block;user-select:none;margin-bottom: 0.25em;}\n\n\t.${Sn}-tools-menu {position:fixed;background: white;padding: 5px 0;min-width: 150px; border-radius: 4px;box-shadow: 1px 1px 10px #3e3e3e94;}\n\t.${Sn}-tools-menu>li {padding: 0.45em 1em;}\n\t.${Sn}-tools-menu>li:hover {background: #eee;cursor: pointer;user-select: none;}\n\n\t.${Sn}[show_thumb_list="false"] .civ-nav-wrap,\n\t.${Sn}[show_toolbar="false"] .civ-view-option {display:none;}\n`,xt.Namespace+"img-preview-style");const ni=()=>!!Mn&&(F(Mn),Mn=null,window.removeEventListener("resize",si),document.removeEventListener("keydown",ai),!0),ii=()=>{let t=Mn.querySelector(".civ-prev"),e=Mn.querySelector(".civ-next"),n=Kn.length;0===Qn?t.setAttribute(On,"1"):t.removeAttribute(On),Qn===n-1?e.setAttribute(On,"1"):e.removeAttribute(On),Mn.querySelectorAll(".civ-nav-list .civ-nav-thumb").forEach((t=>t.classList.remove("active"))),Mn.querySelector(`.civ-nav-list .civ-nav-thumb[data-index="${Qn}"]`).classList.add("active"),ui()},oi=({contentWidth:t,contentHeight:e,containerWidth:n,containerHeight:i,spacing:o=0,zoomIn:r=!1})=>{if(t<=n&&e<=i&&!r)return{width:t,height:e};let a=n/t,l=i/e,s=Math.min(a,l);return{width:t*s-2*o,height:e*s-2*o}},ri=(t=0)=>new Promise(((e,n)=>{let i=ei(Kn[t]),o=Mn.querySelector(".civ-loading"),r=Mn.querySelector(".civ-error"),a=Mn.querySelector(".civ-img");a.innerHTML="",U(o),D(r),$n(i.normal).then((t=>{tt(t,oi({contentWidth:t.width,contentHeight:t.height,containerWidth:a.offsetWidth,containerHeight:a.offsetHeight,spacing:20})),D(o),a.innerHTML="",t.setAttribute(Nn,t.width),t.setAttribute(In,t.height),(t=>{let e=!1,n={};t.addEventListener("mousedown",(i=>{e=!0,n={clientX:i.clientX,clientY:i.clientY,marginLeft:parseInt(t.style.marginLeft||0,10),marginTop:parseInt(t.style.marginTop||0,10)},i.preventDefault()})),["mouseup","mouseout"].forEach((n=>{t.addEventListener(n,(t=>{e=!1}))})),t.addEventListener("mousemove",(i=>{e&&ti.get("allow_move")&&(t.style.marginLeft=w(n.marginLeft+(i.clientX-n.clientX)),t.style.marginTop=w(n.marginTop+(i.clientY-n.clientY)))}))})(t),a.appendChild(t),e(t)}),(t=>{D(o),r.innerHTML=`图片加载失败，<a href="${i.normal}" target="_blank">查看详情(${t})</a>`,U(r),n(r)}))})),ai=t=>{t.keyCode===Ut.LeftArrow&&(t.stopPropagation(),di(!0)),t.keyCode===Ut.RightArrow&&(t.stopPropagation(),di(!1)),t.keyCode===Ut.Esc&&ni()&&t.stopPropagation()};let li=null;const si=()=>{li&&clearTimeout(li),li=setTimeout((()=>{ci()}),50)},ci=()=>{let t=Mn.querySelector(".civ-img img");if(!t)return;let e=Mn.querySelector(".civ-img");tt(t,oi({contentWidth:t.getAttribute(Nn),contentHeight:t.getAttribute(In),containerWidth:e.offsetWidth,containerHeight:e.offsetHeight,spacing:20})),tt(t,{marginLeft:0,marginTop:0})},di=(t=!1)=>{let e=Kn.length;if(t&&0===Qn||!t&&Qn===e-1)return!1;t?Qn--:Qn++,ri(Qn),ii()},hi=t=>{Qn=t,ri(Qn),ii()},pi=(t,e=200)=>{let n=H(".civ-nav-list-wrap",Mn),i=H(".civ-nav-list",Mn).scrollWidth-n.offsetWidth,o=n.scrollLeft+(t?-1:1)*e;n.scrollLeft=Math.max(Math.min(o,i),0)},ui=()=>{H(".civ-nav-list .active",Mn).scrollIntoView()},mi=t=>{let e=Mn.querySelector(".civ-img img"),n=e.getAttribute(Nn),i=e.getAttribute(In);if(null===t)return t=1,e.style.left=w(parseInt(e.style.left,10)*t),e.style.top=w(parseInt(e.style.top,10)*t),e.style.width=w(parseInt(n,10)*t),void(e.style.height=w(parseInt(i,10)*t));let o=parseInt(e.style.width,10)*t,r=parseInt(e.style.height,10)*t;t>1&&o>n&&(o/n>2||r/i>2)?console.warn("zoom in limited"):t<1&&o<n&&(o<50||r<50)?console.warn("zoom out limited"):(e.style.left=w(parseInt(e.style.left,10)*t),e.style.top=w(parseInt(e.style.top,10)*t),e.style.width=w(parseInt(e.style.width,10)*t),e.style.height=w(parseInt(e.style.height,10)*t))},gi=t=>{let e=Mn.querySelector(".civ-img img"),n=parseInt(e.getAttribute("data-rotate")||0,10)+t;e.setAttribute("data-rotate",n),e.style.transform=`translate(-50%, -50%) rotate(${n}deg)`},fi=()=>{window.open(ei(Kn[Qn]).original)},bi=()=>{let t=`\n<ul class="${Sn}-option-list">\n\t<li>\n\t\t<label>界面：</label>\n\t\t<label style="display:none" title="该选项不启用，操作不闭环">\n\t\t\t<input type="checkbox" name="show_toolbar" value="1">显示顶部操作栏\n\t\t</label>\n\t\t<label>\n\t\t\t<input type="checkbox" name="show_thumb_list" value="1">显示底部缩略图列表（多图模式）\n\t\t</label>\n\t</li>\t\n\t<li>\n\t\t<label>鼠标滚轮：</label>\n\t\t<label><input type="radio" name="mouse_scroll_type" value="2">切换前一张、后一张图片</label>\n\t\t<label><input type="radio" name="mouse_scroll_type" value="1">缩放图片</label>\n\t\t<label><input type="radio" name="mouse_scroll_type" value="0">无动作</label>\n\t</li>\n\t<li>\n\t\t<label>移动：</label>\n\t\t<label><input type="checkbox" name="allow_move" value="1">允许移动图片</label>\n\t</li>\n</ul>\n\t`,e=Ze.show("设置",t,{modal:!0});e.dom.style.zIndex=Rn+"";let n=null;re(e.dom,(t=>new Promise(((e,n)=>{e(ve({[t]:ti.get(t)})[t])}))),((t,e)=>new Promise(((i,o)=>{let r=he({[t]:e},Zn);ti.set(t,r[t]),n&&n.hide(),n=Ot.showSuccess("设置已保存"),i()}))))},vi=[Fn,Un,Hn,zn,qn,Bn,Vn,Wn,Gn,jn,Yn,Jn,Xn],wi=[Bn,Vn,Wn,Gn,jn,Yn,Xn],$i=t=>{for(let e in vi){let[n]=vi[e];if(t===n)return vi[e]}return null},yi=({mode:t,srcList:e,mouse_scroll_type:n=2,startIndex:i=0,showContextMenu:o=null,showToolbar:r=null,showThumbList:a=null,preloadSrcList:l=null})=>{ni(),Dn=t,Kn=e,Qn=i,null!==n&&ti.set("mouse_scroll_type",n),null!==a&&ti.set("show_thumb_list",a),null!==r&&ti.set("show_toolbar",r),(()=>{let t=`\n\t\t<div class="civ-nav-wrap">\n\t\t\t<span class="civ-nav-list-prev" tabindex="0" data-cmd="${zn[0]}"></span>\n\t\t\t<div class="civ-nav-list-wrap">\n\t\t\t\t<div class="civ-nav-list">\n\t\t\t\t${Kn.reduce(((t,e,n)=>t+`<span class="civ-nav-thumb" tabindex="0" data-cmd="${Hn[0]}" data-index="${n}"><img src="${ei(e).thumb}"/></span>`),"")}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span class="civ-nav-list-next" tabindex="0" data-cmd="${qn[0]}"></span>\n\t\t</div>`,e=`\n\t<span class="civ-view-option">\n\t\t${wi.reduce(((t,e,n)=>t+`<span class="civ-opt-btn ${Sn}-icon ${Sn}-icon-${e[0]}" tabindex="0" data-cmd="${e[0]}" title="${e[1]}"></span>`),"")}\n\t</span>`;var n,i,o;Mn=nt(`\n\t\t<dialog class="${Sn}" data-ip-mode="${Dn}">\n\t\t\t<span tabindex="0" class="civ-closer" data-cmd="${Fn[0]}" title="ESC to close">close</span>\n\t\t\t<span tabindex="0" class="civ-nav-btn civ-prev" data-cmd="${Un[0]}" data-dir="0"></span>\n\t\t\t<span tabindex="0" class="civ-nav-btn civ-next" data-cmd="${Un[0]}" data-dir="1"></span>\n\t\t\t${e}\n\t\t\t${t}\n\t\t\t<div class="civ-ctn">\n\t\t\t\t<span class="civ-loading"></span>\n\t\t\t\t<span class="civ-error"></span>\n\t\t\t\t<span class="civ-img"></span>\n\t\t\t</div>\n\t\t</dialog>\n\t`,document.body),ti.each(((t,e)=>{Mn.setAttribute(t,JSON.stringify(e))})),ti.onUpdated(((t,e)=>{Mn&&Mn.setAttribute(t,JSON.stringify(e))})),z("[data-cmd]",Mn).forEach((t=>{Mt(t,(()=>{let e=t.getAttribute("data-cmd");if(t.getAttribute(On))return!1;let n=$i(e);if(n)return n[2](t);throw"no command found."}))})),Mt(H(".civ-ctn",Mn),(t=>{t&&"IMG"!==t.target.tagName&&ni()})),H(".civ-nav-wrap",Mn).addEventListener("mousewheel",(t=>(di(t.wheelDelta>0),t.preventDefault(),!1))),n=".civ-ctn",i="mousewheel",o=t=>{switch(ti.get("mouse_scroll_type")){case 1:mi(t.wheelDelta>0?1.2:.8);break;case 2:di(t.wheelDelta>0)}return t.preventDefault(),!1},Mn.querySelectorAll(n).forEach((t=>{t.addEventListener(i,o)})),Mn.showModal(),window.addEventListener("resize",si),Mn.addEventListener("keydown",ai)})(),ri(Qn).finally((()=>{l&&e.forEach((t=>{(new Image).src=t}))})),2===t&&setTimeout(ii,100)},Ei=Ln[Cn].showImgPreview||function(t,e={}){yi({mode:1,srcList:[t],...e})},xi=Ln[Cn].showImgListPreview||function(t,e=0,n={}){yi({mode:2,srcList:t,startIndex:e,...n})},Ai=(t="img",e="click",n="src",i={})=>{let o=z(t),r=[];o.length?o.forEach(((t,a)=>{switch(typeof n){case"function":r.push(n(t));break;case"string":r.push(t.getAttribute(n));break;default:throw"No support srcFetcher types:"+typeof n}t.addEventListener(e,(t=>{o.length>1?xi(r,a,i):Ei(r[0],i)}))})):console.warn("no images found")};window[Cn]={showImgPreview:Ei,showImgListPreview:xi,bindImgPreviewViaSelector:Ai};let _i=Ln[Cn].showImgPreview||Ei,Ti=Ln[Cn].showImgListPreview||xi;const Ci=t=>{let e=t.dataset.src;return"IMG"===t.tagName?(!e&&t.srcset&&(e=yn(t.srcset)),e=e||t.src):e||"A"!==t.tagName||(e=t.href),e};class Li{static active(t,e={}){return new Promise(((n,i)=>{let o=e.watch;if(o)return Ft(t,o,"click",((e,n)=>{let i=0,r=[];t.querySelectorAll(o).forEach(((e,o)=>{t===n&&(i=o),r.push(Ci(n))})),Ti(r,i)})),void n();let r=e.src||Ci(t),a=e.selector;if(r){if(a){let e=0,n=[];z(a).forEach(((i,o)=>{t===i&&(e=o),n.push(Ci(i))})),Ti(n,e)}else _i(r);n()}else console.warn("image preview src empty",t)}))}}const Si=xt.Namespace+"select",Ni=Si;K(`\n\t.${Ni}-panel{\n\t\t${xt.CssVarPrefix}sel-panel-max-width:20em;\n\t\t${xt.CssVarPrefix}sel-list-max-height:15em;\n\t\t${xt.CssVarPrefix}sel-item-matched-color:orange;\n\t\t${xt.CssVarPrefix}sel-item-matched-font-weight:bold;\n\t\t${xt.CssVarPrefix}sel-item-hover-bg:#eeeeee;\n\t\t${xt.CssVarPrefix}sel-item-selected-bg:#abc9e140;\n\t\t\n\t\tmax-width:var(${xt.CssVarPrefix}sel-panel-max-width);\n\t\tbackground-color:var(${xt.CssVar.BACKGROUND_COLOR});\n\t\tborder:var(${xt.CssVar.PANEL_BORDER});\n\t\tpadding:.2em 0;\n\t\tbox-sizing:border-box;\n\t\tbox-shadow:var(${xt.CssVar.PANEL_SHADOW});\n\t\tborder-radius:var(${xt.CssVar.PANEL_RADIUS});\n\t\tposition:absolute;\n\t\tz-index:1;\n\t}\n\t\n\t.${Ni}-panel .${Ni}-search{padding:0.5em;}\n\t.${Ni}-panel input[type=search]{\n\t\twidth:100%;\n\t\tpadding:0.5em;\n\t\tborder:none;\n\t\tborder-bottom:1px solid #dddddd;\n\t\toutline:none;\n\t\tbox-shadow:none;\n\t\ttransition:border 0.1s linear;\n\t}\n\t.${Ni}-panel input[type=search]:focus{\n\t\tborder-color:gray;\n\t}\n\t\n\t.${Ni}-list{\n\t\tlist-style:none;\n\t\tmax-height:var(${xt.CssVarPrefix}sel-list-max-height);\n\t\toverflow:auto;\n\t}\n\t\n\t.${Ni}-list .sel-item{\n\t\tmargin:1px 0;\n\t}\n\t\n\t.${Ni}-list .sel-chk{\n\t\topacity:0;\n\t\twidth:1em;\n\t\theight:1em;\n\t\tposition:absolute;\n\t\tmargin:0.05em 0 0 -1.25em;\n\t}\n\t\n\t.${Ni}-list .sel-chk:before{\n\t\tcontent:"\\e624";\n\t\tfont-family:"${xt.IconFont}", serif;\n\t}\n\t\n\t.${Ni}-list .matched{\n\t\tcolor:var(${xt.CssVarPrefix}sel-item-matched-color);\n\t\tfont-weight:var(${xt.CssVarPrefix}sel-item-matched-font-weight);\n\t}\n\t\n\t.${Ni}-list input{display:block;position:absolute;z-index:1;left:-2em;top:0;opacity:0;}\n\t.${Ni}-list .ti-wrap{cursor:pointer;position:relative;display:block;padding:.35em .5em .35em 2em;user-select:none;transition:all 0.1s linear;}\n\t.${Ni}-list ul .ti-wrap{padding-left:2.25em;display:block; padding-left:3.5em;}\n\t\n\t.${Ni}-list label{\n\t\tdisplay:block;\n\t\toverflow:hidden;\n\t\tposition:relative;\n\t}\n\t.${Ni}-list label:hover .ti-wrap{\n\t\tbackground:var(${xt.CssVarPrefix}sel-item-hover-bg);\n\t\ttext-shadow:1px 1px 1px white;\n\t}\n\t\n\t.${Ni}-list li[data-group-title]:before{\n\t\tcontent:attr(data-group-title) " -";\n\t\tcolor:gray;\n\t\tdisplay:block;\n\t\tpadding:0.25em .5em .25em 2em;\n\t}\n\t\n\t/** checked **/\n\t.${Ni}-list input:checked ~ .ti-wrap{\n\t\tbackground-color:var(${xt.CssVarPrefix}sel-item-selected-bg);\n\t}\n\t\n\t.${Ni}-list input:checked ~ .ti-wrap .sel-chk{\n\t\topacity:1;\n\t}\n\t\n\t/** disabled **/\n\t.${Ni}-list input:disabled ~ .ti-wrap{\n\t\topacity:0.5;\n\t\tcursor:default;\n\t\tbackground-color:transparent\n\t}\n\t.${Ni}-list input:disabled ~ .ti-wrap .sel-chk{\n\t\topacity:.1;\n\t}\n`,Si+"-style");const Ii=(t,e,n)=>`<input type="${e?"checkbox":"radio"}" \n\t\ttabindex="-1"\n\t\tname="${t}" \n\t\tvalue="${E(n.value)}" \n\t\t${n.selected?"checked":""} \n\t\t${n.disabled?"disabled":""}/>\n\t`,Oi=(t,e)=>{let n=-1;t.forEach(((t,e)=>{t===document.activeElement&&(n=e)})),n=e>0?n<t.length-1?n+1:0:n<=0?t.length-1:n-1,t.forEach(((t,e)=>{e===n&&t.focus()}))};class ki{constructor(t){for(let e in t)this[e]=t[e]}title="";value="";disabled=!1;selected=!1;index=0;options=[]}class Pi{config={name:"",required:!1,multiple:!1,placeholder:"",displaySearchInput:!0,hideNoMatchItems:!0,options:[]};panelEl=null;searchEl=null;onChange=new Rt;constructor(t){this.config=Object.assign(this.config,t),this.config.name=this.config.name||Si+_(),this.panelEl=(t=>{let e=`<ul class="${Ni}-list">`;return t.options.forEach((n=>{n.options&&n.options.length?(e+=`<li data-group-title="${E(n.title)}" class="sel-group"><ul>`,n.options.forEach((n=>{e+=`<li class="sel-item" tabindex="0">\n\t\t\t\t\t\t\t\t\t<label title="${E(n.title)}" tabindex="0">\n\t\t\t\t\t\t\t\t\t\t${Ii(t.name,t.multiple,n)} \n\t\t\t\t\t\t\t\t\t\t<span class="ti-wrap">\n\t\t\t\t\t\t\t\t\t\t\t<span class="sel-chk"></span> \n\t\t\t\t\t\t\t\t\t\t\t<span class="ti">${y(n.title)}</span>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t</li>`})),e+="</ul></li>"):e+=`<li class="sel-item" tabindex="0">\n\t\t\t\t\t\t\t<label title="${E(n.title)}">\n\t\t\t\t\t\t\t\t${Ii(t.name,t.multiple,n)} \n\t\t\t\t\t\t\t\t<span class="ti-wrap">\n\t\t\t\t\t\t\t\t\t<span class="sel-chk"></span> \n\t\t\t\t\t\t\t\t\t<span class="ti">${y(n.title)}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</li>`})),e+="</ul>",nt(`\n\t\t<div class="${Ni}-panel" style="display:none;">\n\t\t\t<div class="${Ni}-search" style="${t.displaySearchInput?"":"display:none"}">\n\t\t\t\t<input type="search" placeholder="过滤..." aria-label="过滤选项">\n\t\t\t</div>\n\t\t\t${e}\n\t\t</div>\n\t`,document.body)})(this.config),this.searchEl=this.panelEl.querySelector("input[type=search]"),this.panelEl.querySelectorAll(`.${Ni}-list input`).forEach((t=>{t.addEventListener("change",(()=>{this.onChange.fire()}))})),this.searchEl.addEventListener("input",(()=>{this.search(this.searchEl.value)})),this.searchEl.addEventListener("keydown",(t=>{t.keyCode===Ut.UpArrow?Oi(e,!1):t.keyCode===Ut.DownArrow&&Oi(e,!0)}));let e=this.panelEl.querySelectorAll(`.${Ni}-list .sel-item`);e.forEach((t=>{Mt(t,(e=>{if("click"!==e.type){let e=t.querySelector("input");e.checked?e.removeAttribute("checked"):e.checked=!0,this.onChange.fire()}!this.config.multiple&&this.hidePanel()})),t.addEventListener("keydown",(t=>{t.keyCode===Ut.UpArrow?Oi(e,!1):t.keyCode===Ut.DownArrow&&Oi(e,!0)}))}))}isShown(){return"none"!==this.panelEl.style.display}search(t){this.searchEl.value=t;let e=this.panelEl.querySelectorAll(`.${Ni}-list .sel-item`),n=null;e.forEach((e=>{this.config.hideNoMatchItems&&D(e);let i=e.querySelector("label").title;e.blur(),e.querySelector(".ti").innerHTML=x(i,t),(!t||i.toLowerCase().indexOf(t.trim().toLowerCase())>=0)&&(this.config.hideNoMatchItems&&U(e),n||(n=e))})),n&&n.scrollIntoView({behavior:"smooth"})}selectByIndex(t){this.panelEl.querySelectorAll(`.${Ni}-list input`).forEach(((e,n)=>{e.checked=t.includes(n)}))}selectByValues(t){this.panelEl.querySelectorAll(`.${Ni}-list input`).forEach(((e,n)=>{e.checked=t.includes(e.value)}))}getValues(){let t=[];return this.panelEl.querySelectorAll(`.${Ni}-list input:checked`).forEach((e=>{t.push(e.value)})),t=te(t),t}getSelectedIndexes(){let t=[];return this.panelEl.querySelectorAll(`.${Ni}-list input`).forEach(((e,n)=>{e.checked&&t.push(n)})),t}hidePanel(){this.panelEl&&(this.panelEl.style.display="none",this.search(""))}showPanel(t={top:0,left:0}){this.panelEl.style.display="",t&&(this.panelEl.style.top=w(t.top),this.panelEl.style.left=w(t.left)),this.searchEl.focus()}static bindSelect(t){let{options:e}=(t=>{let e=[],n=[],i=[];return t.childNodes.forEach((t=>{if(1===t.nodeType)if("OPTION"===t.tagName)e.push(new ki({title:t.innerText,value:t.value,disabled:t.disabled,selected:t.selected,index:t.index})),t.selected&&(n.push(t.value),i.push(t.index));else if("OPTGROUP"===t.tagName){let o=new ki({title:t.label});t.childNodes.forEach((t=>{1===t.nodeType&&(o.options.push(new ki({title:t.innerText,value:t.value,disabled:t.disabled,selected:t.selected,index:t.index})),t.selected&&(n.push(t.value),i.push(t.index)))})),e.push(o)}})),{options:e,values:n,selectedIndexes:i}})(t);const n=new Pi({name:t.name,required:t.required,multiple:t.multiple,placeholder:t.getAttribute("placeholder"),options:e}),i=()=>{let e=q(t);n.showPanel({top:e.top+t.offsetHeight,left:e.left})};t.addEventListener("invalid",(()=>{n.hidePanel()})),t.addEventListener("input",(()=>{i()})),n.onChange.listen((()=>{let e=n.getSelectedIndexes();t.querySelectorAll("option").forEach(((t,n)=>{t.selected=e.includes(n)})),Dt(t,"change")})),n.panelEl.style.minWidth=w(t.offsetWidth),t.addEventListener("keydown",(t=>(i(),t.preventDefault(),t.stopPropagation(),!1))),t.addEventListener("mousedown",(t=>(n.isShown()?n.hidePanel():i(),t.preventDefault(),t.stopPropagation(),!1))),t.addEventListener("focus",i),t.addEventListener("change",(()=>{let e=[];Array.from(t.selectedOptions).forEach((t=>{e.push(t.index)})),n.selectByIndex(e)})),document.addEventListener("click",(e=>{V(n.panelEl,e.target,!0)||V(t,e.target,!0)||n.hidePanel()})),document.addEventListener("keyup",(t=>{t.keyCode===Ut.Esc&&n.hidePanel()}))}static bindTextInput(t,e=null){if(!e){let n=t.getAttribute("list"),i=document.getElementById(n);if(!i)throw"no datalist found: "+t.getAttribute("list");e=((t,e=null)=>{let n=[];return Array.from(t.options).forEach(((t,i)=>{let o=t.innerText,r=t.hasAttribute("value")?t.getAttribute("value"):t.innerText,a=null!==e&&r===e;n.push({title:o,value:r,disabled:!1,selected:a,index:i})})),n})(i,t.value),t.removeAttribute("list"),F(i)}let n=new Pi({name:t.name,required:t.required,multiple:!1,displaySearchInput:!1,hideNoMatchItems:!1,placeholder:t.getAttribute("placeholder"),options:e});n.onChange.listen((()=>{t.value=n.getValues()[0],Dt(t,"change")})),n.panelEl.style.minWidth=w(t.offsetWidth);let i=()=>{let e=q(t);n.showPanel({top:e.top+t.offsetHeight,left:e.left})};t.addEventListener("focus",i),t.addEventListener("click",i),t.addEventListener("input",(()=>{n.search(t.value.trim())})),document.addEventListener("click",(e=>{V(n.panelEl,e.target,!0)||V(t,e.target,!0)||n.hidePanel()})),document.addEventListener("keyup",(t=>{t.keyCode===Ut.Esc&&n.hidePanel()}))}}class Ri{static init(t){return new Promise(((e,n)=>"SELECT"===t.tagName?(Pi.bindSelect(t),void e()):"INPUT"===t.tagName&&t.list?(Pi.bindTextInput(t),void e()):void n("node type no support")))}}class Mi{static cssClass="highlight";static init(t,e={}){return new Promise(((n,i)=>{let o=(e.keyword||e.kw||"").trim();o&&et(t,o,Mi.cssClass),n()}))}}const Di="全选",Fi="取消选择";class Ui{static init(t,e={}){return new Promise(((n,i)=>{let o=[],r=H(e.container||"body"),a=()=>{let e=0;o.forEach((t=>{e+=t.checked?1:0})),t.innerHTML=e?Fi:Di,o.length?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")};G(r,(()=>{o=z("input[type=checkbox]",r),o.forEach((t=>{t.dataset.__bind_select_all||(t.dataset.__bind_select_all="1",t.addEventListener("change",a))})),a()})),t.addEventListener("click",(e=>{let n=t.innerHTML===Di;o.forEach((t=>{t.checked=n,Dt(t,"change")})),t.innerHTML=n?Fi:Di}));let l=()=>{o=z("input[type=checkbox]",r),o.forEach((t=>{t.dataset.__bind_select_all||(t.dataset.__bind_select_all="1",t.addEventListener("change",a))})),a()};G(r,l),l()}))}}class Hi{static init(t,e={}){return new Promise(((n,i)=>{const o=H(e.container||"body");j(o,"input:checked",(e=>{e.length?(t.title="",t.removeAttribute("disabled"),t.classList.remove("button-disabled")):(t.title="请选择要操作的项目",t.setAttribute("disabled","disabled"),t.classList.add("button-disabled"))}))}))}}const zi=xt.Namespace+"uploader";K(`\n\t.${zi}{display:inline-block;position:relative;background-color:#dddddd;width:80px;height:80px;overflow:hidden;}\n\t\n\t.${zi}-file{width:100%;height:100%;position:absolute;cursor:pointer;display:flex;align-items:center;}\n\t.${zi}-file:before{flex:1;font-family:WebCom-iconfont, serif;content:"\\e9de";font-size:30px;text-align:center;}\n\t.${zi}-file input[type=file]{position:absolute;width:1px;height:1px;left:0;top:0;opacity:0;}\n\t\n\t.${zi}[data-state="empty"]{opacity:0.5}\n\t.${zi}[data-state="empty"]:hover{opacity:1; transition:all 0.2s linear}\n\t\n\t.${zi}[data-state="empty"] :is(.${zi}-handle,.${zi}-progress),\n\t.${zi}[data-state="pending"] :is(.${zi}-btn-clean, .${zi}-file, .${zi}-content),\n\t.${zi}[data-state="error"] :is(.${zi}-progress,.${zi}-btn-clean),\n\t.${zi}[data-state="normal"] :is(.${zi}-progress,.${zi}-btn-cancel),\n\t.${zi}[data-state="normal"] .${zi}-file:before{\n\t\tdisplay:none;\n\t}\n\t\n\t.${zi}-handle{width:100%;position:absolute;padding:.25em;text-align:right;box-sizing:border-box;bottom:0;}\n\t.${zi}-content{width:100%;height:100%;}\n\t.${zi}-content img{display:inline-block;width:100%;height:100%;object-fit:cover;}\n\t\n\t.${zi}-progress{width:100%;height:100%;padding:0 .5em;display:flex;flex-direction:column;box-sizing:border-box;justify-content:center;align-items:center;font-size:0.9em;color:gray;user-select:none;}\n\t.${zi}-progress progress{width:100%; transition:all 1s linear}\n\t\n\t.${zi}-btn{display:inline-block;user-select:none;cursor:pointer;color:white;text-shadow:1px 1px 1px gray;opacity:0.7;}\n\t.${zi}-btn:hover{opacity:1;}\n\t.${zi}-btn:before{content:""; font-family:WebCom-iconfont, serif}\n\t.${zi}-btn-cancel:before{content:"\\e61a"}\n\t.${zi}-btn-clean:before{content:"\\e61b"}\n`);const qi=`${zi}-image`,Bi=`${zi}-file`,Vi="empty",Wi="pending",Gi="error",ji="normal",Yi=(t,e,n)=>Jt(t,e,{onSuccess:t=>{let e=JSON.parse(t);if(0!==e.code)return{error:e.message};n.onSuccess({value:e.data.value,thumb:e.data.thumb,name:e.data.name,error:null})},onError:n.onError,onAbort:n.onAbort,onProgress:n.onProgress}),Ji=t=>{try{t.xhr&&t.xhr.abort()}catch(t){console.error(t)}Xi(t,t.value?ji:Vi)},Xi=(t,e,n=null)=>{const i=H("input[type=file]",t.dom),o=H(`.${zi}-content`,t.dom);switch(t.dom.setAttribute("data-state",e),t.dom.title="",e){case Vi:i.value="",o.innerHTML="",t.onClean.fire();break;case Wi:t.onUploading.fire();break;case ji:i.value="",t.dom.title=t.name,o.innerHTML=`<img alt="" src="${t.thumb}">`,t.onSuccess.fire({name:t.name,value:t.value,thumb:t.thumb});break;case Gi:i.value="",Xi(t,t.value?ji:Vi),console.error("Uploader Error:",n),t.onError.fire(n);break;default:throw"todo"}};class Ki{state=Vi;xhr=null;dom=null;value=null;thumb="";name="";onSuccess=new Rt;onAbort=new Rt;onUploading=new Rt;onClean=new Rt;onError=new Rt;static globalUploadUrl=null;static globalRequestHandle=Yi;option={uploadUrl:null,uploadFileFieldName:"file",required:!1,allowFileTypes:[],fileSizeLimit:0,requestHandle:null};static bindFileInput(t,e={},n={}){let i=e.name||t.name,o=e.value||t.value,r=t.accept.split(","),a=document.createElement("span");n.required=t.required,r.length&&(n.allowFileTypes=r),t.parentNode.insertBefore(a,t.nextSibling),t.required=!1,t.style.cssText="display:none";const l=new Ki(a,{name:i,value:o,thumb:e.thumb},n);return l.onClean.listen((()=>{t.value="",Dt(t,"change")})),"file"!==t.type&&l.onSuccess.listen((e=>{t.value=e.value,Dt(t,"change")})),l}constructor(t,e={},n={uploadUrl:null,required:null,fileSizeLimit:null,allowFileTypes:null}){this.value=e.value||"",this.thumb=e.thumb||"",this.name=e.name||"",((t,e)=>{for(let n in e)null!==e[n]&&(t[n]=e[n])})(this.option,n);const i=this.option.uploadUrl||Ki.globalUploadUrl,o=this.option.requestHandle||Ki.globalRequestHandle;if(!i)throw"上传组件需要提供上传接口地址：option.uploadUrl 或者 Uploader.globalUploadUrl";if(!o)throw"上传组件需要提供上传请求函数：option.requestHandle 或者 Uploader.globalRequestHandle";this.onError.listen((t=>{Ot.showError(t)}));let r=this.option.allowFileTypes.join(",");const a=`<div class="${zi}" data-state="${this.state}">\n\t\t\t<label class="${zi}-file">\n\t\t\t\t<input type="file" tabindex="0" accept="${r}" value="${this.value}" ${this.option.required?"required":""}>\n\t\t\t</label>\n\t\t\t<div class="${zi}-progress">\n\t\t\t\t<progress max="100" value="0">0%</progress>\n\t\t\t\t<span>0%</span>\n\t\t\t</div>\n\t\t\t<div class="${zi}-content"></div>\n\t\t\t<div class="${zi}-handle">\n\t\t\t\t<span role="button" tabindex="0" class="${zi}-btn ${zi}-btn-cancel" title="取消上传"></span>\n\t\t\t\t<span role="button" tabindex="0" class="${zi}-btn ${zi}-btn-clean" title="清除"></span>\n\t\t\t</div>\n\t\t</div>`;this.dom=nt(a,t);const l=H("input[type=file]",this.dom);Mt(H(`.${zi}-btn-clean`,this.dom),(()=>{Xi(this,Vi)})),Mt(H(`.${zi}-btn-cancel`,this.dom),(()=>{Ji(this)})),Xi(this,this.value?ji:Vi),l.addEventListener("change",(()=>{let t=l.files[0];if(t){if(t.size<1)return void Ot.showError("所选的文件内容为空");if(this.option.fileSizeLimit&&t.size<this.option.fileSizeLimit)return void Ot.showError("所选的文件大小超出限制");Xi(this,Wi),this.xhr=o(i,{[this.option.uploadFileFieldName]:t},{onSuccess:t=>{try{(t=>{let e=["value","name","thumb","error"];if("object"!=typeof t)throw`文件上传返回结果必须是对象，包含 ${e.join("、")} 属性`;let n=Object.keys(t);e.forEach((t=>{if(!n.includes(t))throw`文件上传返回对象必须包含 ${t} 属性`}))})(t);let{value:e,thumb:n,name:i}=t;this.value=e,this.thumb=n,this.name=i,Xi(this,ji)}catch(t){Xi(this,Gi,t)}},onProgress:(t,e)=>{const n=H("progress",this.dom),i=H(`.${zi}-progress span`,this.dom);n.value=t,n.max=e,i.innerHTML=Math.round(100*t/e)+"%",Xi(this,Wi)},onError:t=>{Xi(this,Gi,t)},onAbort:()=>{Xi(this,Gi,"上传被中断")}})}}))}abort(){Ji(this)}getValue(){return this.value}getValueAsync(){return new Promise(((t,e)=>{if(this.state!==Wi)t(this.getValue());else{let n=()=>{t(this.getValue()),this.onSuccess.remove(n)},i=t=>{e(t),this.onError.remove(i)};this.onSuccess.listen(n),this.onError.listen(i)}}))}}class Qi{static init(t,e){return new Promise((n=>{Ki.bindFileInput(t,e,e),n()}))}}const Zi="active",to="inactive",eo="normal",no="overload",io=xt.Namespace+"-text-counter";K(`\n.${io} {pointer-events:none; margin-left:0.5em; user-select:none;}\n.${io}[data-state="${eo}"][data-ui-state="${to}"] {opacity:0.5}\n.${io}[data-state="${eo}"][data-ui-state="${Zi}"] {}\n.${io}[data-state="${no}"][data-ui-state="${to}"] {opacity:0.8; color:red}\n.${io}[data-state="${no}"][data-ui-state="${Zi}"] {color:red}\n`);class oo{static init(t,e={}){return new Promise(((n,i)=>{let o=t.maxlength||e.maxlength,r=e.trim;if(!o)throw"input maxlength required";const a=nt(`<span class="${io}" data-state="${eo}" data-ui-state="${to}">0/${o}</span>`),l=()=>{let e=r?t.value.trim().length:t.value.length,n=e>o?no:eo;console.log(n),a.setAttribute("data-state",n),a.innerHTML=e+"/"+o};t.parentNode.insertBefore(a,t.nextSibling),t.addEventListener("focus",(()=>{a.setAttribute("data-ui-state",Zi)})),t.addEventListener("blur",(()=>{a.setAttribute("data-ui-state",to)})),t.addEventListener("input",l),l(),n()}))}}const ro=xt.Namespace+"-ac-batchfiller";K(`\n\t.${ro} {padding:2em 2em 1em 2em}\n\t.${ro} label {font-size:1.1em; margin-bottom:.75em; display:block;}\n\t.${ro} input,\n\t.${ro} textarea,\n\t.${ro} select {width:100%; box-sizing:border-box; min-height:2.25em;}\n\t.${ro} textarea {min-height:5em; resize:vertical}\n`);const ao=["color","date","datetime","datetime-local","month","week","time","email","number","password","range","search","tel","text","url"];const lo="data-component",so="component-init-bind";let co={async:$e,copy:gn,dialog:en,confirm:nn,preview:Li,select:Ri,hl:Mi,highlight:Mi,selectall:Ui,selectrelate:Hi,tip:hn,toast:fn,textcounter:oo,uploader:Qi,batchfiller:class{static active(t,e={}){return new Promise(((t,n)=>{let i=z(e.selector);if(!i.length)return void Ot.showInfo("没有可以填写的输入框");let o,r,a=_(ro),l=((t,e="")=>{let n=t.required?"required":"",i=t.getAttribute("pattern")?`pattern="${t.getAttribute("pattern")}"`:"",o=t.placeholder?`placeholder="${E(t.placeholder)}"`:"",r=t.title?`title="${E(t.title)}"`:"",a=t.max?`max=${E(t.max)}`:"",l=t.min?`min=${E(t.min)}`:"",s=t.step?`step=${E(t.step)}`:"",c=e.length?`id="${E(e)}"`:"";switch(t.tagName){case"SELECT":let e=t.hasAttribute("multiple"),d=t.getAttribute("size"),h="";return Array.from(t.options).forEach((t=>{h+=`<option value="${E(t.name)||""}" ${t.disabled?"disabled":""}>\n\t\t\t\t\t\t${y(t.innerText)}\n\t\t\t\t\t</option>`})),`<select ${c} ${n} ${e?"multiple":""} ${d?'size="'+d+'"':""} ${r}>${h}</select>`;case"INPUT":if(ao.includes(t.type.toLowerCase()))return`<input ${c} type="${t.type}" ${a} ${l} ${s} ${n} ${i} ${o} ${r} ${t.maxLength>0?'maxlength="'+t.maxLength+'"':""}>`;throw"no support type"+t.type;case"TEXTAREA":return`<textarea ${c} ${i} ${n} ${o} ${r} ${t.maxLength>0?'maxlength="'+t.maxLength+'"':""}></textarea>`;default:throw"no support type"+t.type}})(i[0],a),s=e.title||"批量设置",c=()=>{i.forEach((t=>{switch(o.tagName){case"TEXTAREA":case"INPUT":t.value=o.value;break;case"SELECT":if(o.multiple){let e=[];Array.from(o.selectedOptions).forEach((t=>{e.push(t.index)}));for(let n=0;n<t.options.length;n++)t.options[n].selected=e.includes(n)}else t.selectedIndex=o.selectedIndex;break;default:throw"no support tag:"+o.tagName}Dt(t,"change")})),r.close()};r=Ze.show("",`<div class="${ro}">\n\t<label for="${a}">${s}</label>\n\t<div>${l}</div>\n</div>`,{width:350,buttons:[{default:!0,title:"确定",callback:()=>{c(),r.close()}},{title:"关闭",className:Le}]}),o=H("input,textarea,select",r.dom),o.focus(),"INPUT"===o.tagName&&o.addEventListener("keydown",(t=>{t.keyCode===Ut.Enter&&c()})),t()}))}}};const ho=(t,e)=>{let n={};return Array.from(t.attributes).forEach((t=>{if(t.name.indexOf("data-"+e.toLowerCase()+"-")>=0){let i=t.name.substring(("data-"+e.toLowerCase()).length+1);ne(i,t.value,n)}})),n},po=function(t=document,e=lo){z(`:not([${so}])[${e}]`,t).forEach((t=>{let n=function(t){let e=t.split(","),n=[];return e.forEach((t=>{(t=t.trim())&&n.push(t)})),n}(t.getAttribute(e)),i=[],o=0;n.forEach((e=>{let n=co[e];if(!n)return console.warn("component no found",e),!1;o++;let r=ho(t,e);return n.init&&n.init(t,r),n.active&&i.push((i=>n.active(t,ho(t,e),i))),!0})),0!==o&&t.setAttribute(so,"1"),i.length&&mo(t,i)}))},uo=["text","number","password","search","address","date","datetime","time","checkbox","radio"],mo=(t,e)=>{let n;n=(t=>!t.disabled&&!t.readonly&&("TEXTAREA"===t.tagName||"INPUT"===t.tagName&&(!t.type||uo.includes(t.type.toLowerCase()))))(t)?"keyup":"FORM"===t.tagName?"submit":"click",t.addEventListener(n,(t=>{let n=(0,e[0])(t);for(let i=1;i<e.length;i++)n=n.then((()=>e[i](t)),(()=>{}));return t.preventDefault(),!1}))},go={watch:(t=document,e=lo)=>{let n=null;new MutationObserver((()=>{clearTimeout(n),n=setTimeout((function(){po(t,e)}),0)})).observe(t,{childList:!0,subtree:!0}),po(t,e)},register:(t,e)=>{co[t]=e},unRegister:t=>{delete co[t]}},fo=(t,e)=>{let n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},bo=(t,e,n,i,o,r)=>{return fo((a=fo(fo(e,t),fo(i,r)))<<(l=o)|a>>>32-l,n);var a,l},vo=(t,e,n,i,o,r,a)=>bo(e&n|~e&i,t,e,o,r,a),wo=(t,e,n,i,o,r,a)=>bo(e&i|n&~i,t,e,o,r,a),$o=(t,e,n,i,o,r,a)=>bo(e^n^i,t,e,o,r,a),yo=(t,e,n,i,o,r,a)=>bo(n^(e|~i),t,e,o,r,a),Eo=(t,e)=>{let n,i,o,r,a;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let l=1732584193,s=-271733879,c=-1732584194,d=271733878;for(n=0;n<t.length;n+=16)i=l,o=s,r=c,a=d,l=vo(l,s,c,d,t[n],7,-680876936),d=vo(d,l,s,c,t[n+1],12,-389564586),c=vo(c,d,l,s,t[n+2],17,606105819),s=vo(s,c,d,l,t[n+3],22,-1044525330),l=vo(l,s,c,d,t[n+4],7,-176418897),d=vo(d,l,s,c,t[n+5],12,1200080426),c=vo(c,d,l,s,t[n+6],17,-1473231341),s=vo(s,c,d,l,t[n+7],22,-45705983),l=vo(l,s,c,d,t[n+8],7,1770035416),d=vo(d,l,s,c,t[n+9],12,-1958414417),c=vo(c,d,l,s,t[n+10],17,-42063),s=vo(s,c,d,l,t[n+11],22,-1990404162),l=vo(l,s,c,d,t[n+12],7,1804603682),d=vo(d,l,s,c,t[n+13],12,-40341101),c=vo(c,d,l,s,t[n+14],17,-1502002290),s=vo(s,c,d,l,t[n+15],22,1236535329),l=wo(l,s,c,d,t[n+1],5,-165796510),d=wo(d,l,s,c,t[n+6],9,-1069501632),c=wo(c,d,l,s,t[n+11],14,643717713),s=wo(s,c,d,l,t[n],20,-373897302),l=wo(l,s,c,d,t[n+5],5,-701558691),d=wo(d,l,s,c,t[n+10],9,38016083),c=wo(c,d,l,s,t[n+15],14,-660478335),s=wo(s,c,d,l,t[n+4],20,-405537848),l=wo(l,s,c,d,t[n+9],5,568446438),d=wo(d,l,s,c,t[n+14],9,-1019803690),c=wo(c,d,l,s,t[n+3],14,-187363961),s=wo(s,c,d,l,t[n+8],20,1163531501),l=wo(l,s,c,d,t[n+13],5,-1444681467),d=wo(d,l,s,c,t[n+2],9,-51403784),c=wo(c,d,l,s,t[n+7],14,1735328473),s=wo(s,c,d,l,t[n+12],20,-1926607734),l=$o(l,s,c,d,t[n+5],4,-378558),d=$o(d,l,s,c,t[n+8],11,-2022574463),c=$o(c,d,l,s,t[n+11],16,1839030562),s=$o(s,c,d,l,t[n+14],23,-35309556),l=$o(l,s,c,d,t[n+1],4,-1530992060),d=$o(d,l,s,c,t[n+4],11,1272893353),c=$o(c,d,l,s,t[n+7],16,-155497632),s=$o(s,c,d,l,t[n+10],23,-1094730640),l=$o(l,s,c,d,t[n+13],4,681279174),d=$o(d,l,s,c,t[n],11,-358537222),c=$o(c,d,l,s,t[n+3],16,-722521979),s=$o(s,c,d,l,t[n+6],23,76029189),l=$o(l,s,c,d,t[n+9],4,-640364487),d=$o(d,l,s,c,t[n+12],11,-421815835),c=$o(c,d,l,s,t[n+15],16,530742520),s=$o(s,c,d,l,t[n+2],23,-995338651),l=yo(l,s,c,d,t[n],6,-198630844),d=yo(d,l,s,c,t[n+7],10,1126891415),c=yo(c,d,l,s,t[n+14],15,-1416354905),s=yo(s,c,d,l,t[n+5],21,-57434055),l=yo(l,s,c,d,t[n+12],6,1700485571),d=yo(d,l,s,c,t[n+3],10,-1894986606),c=yo(c,d,l,s,t[n+10],15,-1051523),s=yo(s,c,d,l,t[n+1],21,-2054922799),l=yo(l,s,c,d,t[n+8],6,1873313359),d=yo(d,l,s,c,t[n+15],10,-30611744),c=yo(c,d,l,s,t[n+6],15,-1560198380),s=yo(s,c,d,l,t[n+13],21,1309151649),l=yo(l,s,c,d,t[n+4],6,-145523070),d=yo(d,l,s,c,t[n+11],10,-1120210379),c=yo(c,d,l,s,t[n+2],15,718787259),s=yo(s,c,d,l,t[n+9],21,-343485551),l=fo(l,i),s=fo(s,o),c=fo(c,r),d=fo(d,a);return[l,s,c,d]},xo=t=>{let e,n="",i=32*t.length;for(e=0;e<i;e+=8)n+=String.fromCharCode(t[e>>5]>>>e%32&255);return n},Ao=t=>{let e,n=[];for(n[(t.length>>2)-1]=void 0,e=0;e<n.length;e+=1)n[e]=0;let i=8*t.length;for(e=0;e<i;e+=8)n[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return n},_o=t=>{let e,n,i="0123456789abcdef",o="";for(n=0;n<t.length;n+=1)e=t.charCodeAt(n),o+=i.charAt(e>>>4&15)+i.charAt(15&e);return o},To=t=>unescape(encodeURIComponent(t)),Co=t=>(t=>xo(Eo(Ao(t),8*t.length)))(To(t)),Lo=(t,e)=>((t,e)=>{let n,i,o=Ao(t),r=[],a=[];for(r[15]=a[15]=void 0,o.length>16&&(o=Eo(o,8*t.length)),n=0;n<16;n+=1)r[n]=909522486^o[n],a[n]=1549556828^o[n];return i=Eo(r.concat(Ao(e)),512+8*e.length),xo(Eo(a.concat(i),640))})(To(t),To(e));let So=!1;const No=new Rt,Io={listen(t){!So&&new ReportingObserver((t=>{Io.fire(t)}),{types:["deprecation"],buffered:!0}).observe(),So=!0,No.listen(t)},remove:t=>No.remove(t),fire:(...t)=>No.fire(...t)};let Oo=[],ko=!1;const Po=t=>{Oo.forEach((e=>{e(t)}))},Ro=6e4,Mo=36e5,Do=864e5;let Fo=!1;const Uo=(t,e)=>{let n=z(`${t} form`).find((t=>!!ae(t).length));n&&(e.style.left=n.offsetLeft+n.offsetWidth-e.offsetWidth+"px",e.style.top=n.offsetTop+"px")},Ho=t=>{let e=ae(t);if(!e.length)return!1;let n={};e.forEach((e=>{if("hidden"===e.type)return;let i=!!e.required||r(0,5)>2,o=parseInt(e.getAttribute("maxlength")||0)||40,a=e.name;switch(e.type){case"text":case"password":case"search":case"address":i&&(e.value=u(o));break;case"checkbox":e.checked=Math.random()>.5;break;case"radio":if(a.length&&n[a])break;n[a]=!0,i=!0;let l=Array.from(t.querySelectorAll(`input[name=${a}]`));return l[r(0,l.length-1)].setAttribute("checked","checked"),void Dt(e,"change");case"number":let s=e.min?parseFloat(e.min):0,c=e.max?parseFloat(e.max):100;i&&(e.value=r(s,c));break;default:if("SELECT"===e.tagName)i&&(e.selectedIndex=r(0,e.querySelectorAll("option").length-1));else{if("TEXTAREA"!==e.tagName)return;i&&(e.value=u(o,!0))}}i&&Dt(e,"change")}))};let zo=null,qo=xt.Namespace+"-masker";const Bo=t=>(t||(t=nt(`<div class="${qo}"></div>`,document.body)),t.style.display="",t),Vo=t=>{t&&(t.style.display="none")},Wo={zIndex:xt.MaskIndex,show:()=>{zo=Bo(zo)},hide:()=>{Vo(zo)},instance:()=>{let t;return{show:()=>{t=Bo(t)},hide:()=>{Vo(t)}}}};K(`\n.${qo} {\n\tposition:fixed;\n\ttop:0;left:0;\n\tright:0;\n\tbottom:0;\n\tbackground:var(${xt.CssVar.FULL_SCREEN_BACKGROUND_COLOR});\n\tbackdrop-filter:var(${xt.CssVar.FULL_SCREEN_BACKDROP_FILTER});\n\tz-index:${Wo.zIndex}}\n`,xt.Namespace+"masker-style");let Go=xt.Namespace+"context-menu";K(`\n\t.${Go} {z-index:${xt.ContextIndex}; position:fixed;}\n\t.${Go},\n\t.${Go} ul {position:absolute; padding: 0.5em 0; list-style:none; backdrop-filter:var(${xt.CssVar.FULL_SCREEN_BACKDROP_FILTER}); box-shadow:var(${xt.CssVar.PANEL_SHADOW});border-radius:var(${xt.CssVar.PANEL_RADIUS});background:var(${xt.CssVar.BACKGROUND_COLOR});min-width:12em; display:none;}\n\t.${Go} ul {left:100%; top:0;}\n\t.${Go} li:not([disabled]):hover>ul {display:block;}\n\t.${Go} li[role=menuitem] {padding:0 1em; line-height:1; position:relative; min-height:2em; display:flex; align-items:center; background: transparent;user-select:none;opacity: 0.5; cursor:default;}\n\t.${Go} li[role=menuitem]>* {flex:1; line-height:1}\n\t.${Go} li[role=menuitem]:not([disabled]) {cursor:pointer; opacity:1;}\n\t.${Go} li[role=menuitem]:not([disabled]):hover {background-color: #eeeeee9c;text-shadow: 1px 1px 1px white;opacity: 1;}\n\t.${Go} li[data-has-child]:after {content:"\\e73b"; font-family:${xt.IconFont}; zoom:0.7; position:absolute; right:0.5em; color:var(${xt.CssVar.DISABLE_COLOR});}\n\t.${Go} li[data-has-child]:not([disabled]):hover:after {color:var(${xt.CssVar.COLOR})}\n\t.${Go} .sep {margin:0.25em 0.5em;border-bottom:1px solid #eee;}\n\t.${Go} .caption {padding-left: 1em;opacity: 0.7;user-select: none;display:flex;align-items: center;}\n\t.${Go} .caption:after {content:"";flex:1;border-bottom: 1px solid #ccc;margin: 0 0.5em;padding-top: 3px;}\n\t.${Go} li i {--size:1.2em; display:block; width:var(--size); height:var(--size); max-width:var(--size); margin-right:0.5em;} /** icon **/\n\t.${Go} li i:before {font-size:var(--size)}\n`);const jo=(t,e=null)=>{let n=`<ul class="${Go}">`,i={},o=t=>{let e="";if("-"===t)return e+='<li class="sep"></li>',e;let[n,r,a]=t,l=Array.isArray(r),s=_(),c="";return l?(c="<ul>",r.forEach((t=>{c+=o(t)})),c+="</ul>"):i[s]=r,e+=`<li role="menuitem" data-id="${s}" ${l?" data-has-child ":""} ${a?'disabled="disabled"':'tabindex="0"'}>${n}${c}</li>`,e};for(let e=0;e<t.length;e++){let i=t[e];n+=o(i)}n+="</ul>";let r=nt(n,document.body);return r.querySelectorAll("[role=menuitem]:not([disabled])").forEach((function(t){let n=t.getAttribute("data-id"),o=i[n];o&&t.addEventListener("click",(()=>{o(),e&&e(t)}))})),r.querySelectorAll("ul").forEach((function(t){let e=t.parentNode;e.addEventListener("mouseover",(n=>{let i=Zo(t,e);t.style.left=w(i.left),t.style.top=w(i.top)}))})),r.addEventListener("contextmenu",(t=>{})),r};let Yo;const Jo=()=>{F(Yo),Yo=null},Xo=(t,e,n=null)=>{let i=n?.triggerType||"click";t.addEventListener(i,(n=>{Jo();let o,r=jo(e);return Yo=r,o="contextmenu"===i?Ko(r,{left:n.clientX,top:n.clientY}):Qo(r,t),r.style.left=w(o.left),r.style.top=w(o.top),r.style.display="block",n.preventDefault(),n.stopPropagation(),!1}))},Ko=(t,e)=>{let n,i=J(t),o=window.innerWidth,r=window.innerHeight,a=e.left,l=i.width+e.left<=o,s=i.height+e.top<=r,c=e.top-i.height>0;return l&&s?(a=e.left,n=e.top):l&&!s?(a=e.left,n=Math.max(r-i.height,0)):!l&&s?(a=Math.max(o-i.width,0),n=e.top):l||s||(c?(a=Math.max(o-i.width,0),n=e.top-i.height):(a=Math.max(o-i.width,0),n=e.top)),{top:n,left:a}},Qo=(t,e)=>{let n,i,o=J(t),r=e.getBoundingClientRect(),a=window.innerWidth,l=window.innerHeight;return n=l-r.top>o.height&&l-r.top-r.height<o.height?r.top-o.height:r.top+r.height,i=r.left+r.width>o.width&&a-r.left<o.width?r.left+r.width-o.width:r.left,{top:n,left:i}},Zo=(t,e)=>{let n,i,o=J(t),r=e.getBoundingClientRect(),a=window.innerWidth,l=window.innerHeight;return n=r.top+o.height>l&&l>=o.height?l-(r.top+o.height):0,i=r.left>o.width&&r.left+r.width+o.width>a?0-o.width:r.width,{top:n,left:i}};document.addEventListener("click",(t=>{Jo()})),document.addEventListener("keyup",(t=>{t.keyCode===Ut.Esc&&Jo()}));const tr=xt.Namespace+"novice-guide",er=tr;let nr,ir;K(`\n\t.${er}-highlight {\n\t\tposition:absolute; \n\t\tz-index:10000;\n\t\t--novice-guide-highlight-padding:5px; \n\t\tbox-shadow:0 0 10px 2000px #00000057; \n\t\tborder-radius:var(${xt.CssVar.PANEL_RADIUS}); \n\t\tpadding:var(--novice-guide-highlight-padding); \n\t\tmargin:calc(var(--novice-guide-highlight-padding) * -1) 0 0 calc(var(--novice-guide-highlight-padding) * -1); \n\t}\n\t.${er}-btn {user-select:none; cursor:pointer;}\n\t.${er}-masker {width:100%; height:100%; position:absolute; left:0; top:0; z-index:10000}\n\t.${er}-counter {float:left; color:${xt.CssVar.COLOR}; opacity:0.7} \n\t.${er}-next-wrap {text-align:right; margin-top:10px;}\n`,tr);const or=t=>{if(rr(),nr||(nr=nt(`<div class="${er}-highlight"></div>`,document.body),ir=nt(`<div class="${er}-masker"></div>`,document.body)),U(ir),U(nr),t){let e=q(t);return nr.style.left=w(e.left),nr.style.top=w(e.top),nr.style.width=w(t.offsetWidth),void(nr.style.height=w(t.offsetHeight))}return nr.style.left=w(document.body.offsetWidth/2),nr.style.top=w(300),nr.style.width=w(1),nr.style.height=w(1),nr},rr=()=>{ir&&D(ir),nr&&D(nr)},ar=xt.Namespace+"-on-drag",lr=xt.Namespace+"-drag-proxy",sr=(t,e)=>{let n=Array.from(t.children),i=e;for(;i;){if(n.includes(i))return i;i=i.parentNode}throw"event target no in container"};let cr=xt.Namespace+"toc";K(`\n\t.${cr}-wrap {}\n\t.${cr}-wrap ul {list-style:none; padding:0; margin:0}\n\t.${cr}-wrap li {padding-left:calc((var(--toc-item-level) - 1) * 10px)}\n\t.${cr}-collapse>ul {display:none;}\n\t.${cr}-title {display:block; margin:0.1em 0 0; cursor:pointer; user-select:none; padding:0.5em 1em 0.5em 2em;}\n\t.${cr}-title:hover {border-radius:var(${xt.CssVar.PANEL_RADIUS})}\n\t.${cr}-toggle {position:absolute; vertical-align:middle; width:0; height:0; border:0.4em solid transparent; margin:1em 0 0 0.5em; border-top-color:var(${xt.CssVar.COLOR}); opacity:0; cursor:pointer;}\n\t.${cr}-collapse>.${cr}-toggle {border-top-color:transparent; border-left-color:var(${xt.CssVar.COLOR}); margin:.75em 0 0 0.5em;}\n\tli:hover>.${cr}-toggle {opacity:.4}\n\t.${cr}-wrap .${cr}-toggle:hover {opacity:0.8}\n`,xt.Namespace+"toc-style");const dr=(t,e)=>{console.log(e);let n="<ul>";return t.forEach((t=>{n+=`<li data-id="${t.id}" data-level="${t.level}" style="--toc-item-level:${t.level}">\n\t\t\t\t\t${e.collapseAble&&t.children.length?`<span class="${cr}-toggle"></span>`:""}\n\t\t\t\t\t<span class="${cr}-title">${y(t.title)}</span>`,t.children.length&&(n+=dr(t.children,e))})),n+="</ul>",n},hr=(t,e)=>{for(let n=0;n<e.length;n++){if(e[n].id===t)return e[n].relateNode;if(e[n].children.length){let i=hr(t,e[n].children);if(i)return i}}return console.warn("no matched",t,e),null};class pr{dom=null;config={container:null,collapseAble:!0};constructor(t,e={}){this.config=Object.assign(this.config,{container:document.body},e),this.dom=nt(`<div class="${cr}-wrap">\n\t\t\t\t${dr(t,this.config)}\n\t\t\t</div>`,this.config.container),this.dom.querySelectorAll(`li>span.${cr}-title`).forEach((e=>{let n=e.parentNode.getAttribute("data-id");e.addEventListener("click",(e=>{let i=hr(n,t);i.focus(),i.scrollIntoView({behavior:"smooth"})}))})),Ft(this.dom,`.${cr}-toggle`,"click",((t,e)=>{e.closest("li").classList.toggle(cr+"-collapse")}))}static createFromHeading(t=null,e={}){t=t||document;let n=pr.resolveHeading(t);return new pr(n,e)}static resolveHeading(t){let e=Array.from(t.querySelectorAll(["h1","h2","h3","h4","h5","h6"].join(",")))||[],n=[];const i=(t,e,n,o)=>{if(!o.length)return o.push({id:_("toc-"),title:t,level:e,relateNode:n,children:[]});if(o[o.length-1].level<e)i(t,e,n,o[o.length-1].children);else{if(o[o.length-1].level===e)return o.push({id:_("toc-"),title:t,level:e,relateNode:n,children:[]});i(t,e,n,o[o.length-1].children)}};return e.forEach((t=>{let e=parseInt(t.tagName.replace(/\D+/g,""),10),o=t.innerText;i(o,e,t,n)})),console.log(n),n}}e.ACAsync=$e,e.ACComponent=go,e.ACConfirm=nn,e.ACCopy=gn,e.ACDialog=en,e.ACHighlight=Mi,e.ACMultiSelectRelate=Hi,e.ACPreview=Li,e.ACSelect=Ri,e.ACSelectAll=Ui,e.ACTextCounter=oo,e.ACTip=hn,e.ACToast=fn,e.ACUploader=Qi,e.BLOCK_TAGS=b,e.Base64Encode=t=>{let e,n,i,o,r,a,l,s="",c=0;for(t=d(t);c<t.length;)e=t.charCodeAt(c++),n=t.charCodeAt(c++),i=t.charCodeAt(c++),o=e>>2,r=(3&e)<<4|n>>4,a=(15&n)<<2|i>>6,l=63&i,isNaN(n)?a=l=64:isNaN(i)&&(l=64),s=s+bn.charAt(o)+bn.charAt(r)+bn.charAt(a)+bn.charAt(l);return s},e.BizEvent=Rt,e.DLG_CLS_BTN=Ce,e.DLG_CLS_WEAK_BTN=Le,e.Dialog=Ze,e.DialogManager=tn,e.FILE_TYPE_AUDIO=["audio/*"],e.FILE_TYPE_DOCUMENT=[".txt",".md",".doc",".docx"],e.FILE_TYPE_IMAGE=["image/*"],e.FILE_TYPE_SHEET=[".xls",".xlsx",".csv"],e.FILE_TYPE_STATIC_IMAGE=["image/png","image/jpeg","image/jpg","image/webp","image/bmp"],e.FILE_TYPE_VIDEO=["video/*"],e.FILE_TYPE_ZIP=[".7z",".zip",".rar"],e.GOLDEN_RATIO=i,e.HTTP_METHOD=Ht,e.IMG_PREVIEW_MODE_MULTIPLE=2,e.IMG_PREVIEW_MODE_SINGLE=1,e.IMG_PREVIEW_MS_SCROLL_TYPE_NAV=2,e.IMG_PREVIEW_MS_SCROLL_TYPE_NONE=0,e.IMG_PREVIEW_MS_SCROLL_TYPE_SCALE=1,e.KEYS=Ut,e.LocalStorageSetting=Tn,e.MD5=(t,e,n)=>e?n?Lo(e,t):_o(Lo(e,t)):n?Co(t):_o(Co(t)),e.Masker=Wo,e.Net=Xt,e.ONE_DAY=Do,e.ONE_HOUR=Mo,e.ONE_MINUTE=Ro,e.ONE_MONTH_30=2592e6,e.ONE_MONTH_31=26784e5,e.ONE_WEEK=6048e5,e.ONE_YEAR_365=31536e6,e.PROMISE_STATE_FULFILLED=R,e.PROMISE_STATE_PENDING=P,e.PROMISE_STATE_REJECTED=M,e.ParallelPromise=class{parallel_limit=0;current_running_count=0;task_stack=[];constructor(t){if(t<1)throw"最大并发数量必须大于0";this.parallel_limit=t}loop(){for(let t=0;t<this.parallel_limit-this.current_running_count;t++){if(!this.task_stack.length)return;this.current_running_count++;let{promiseFn:t,args:e,resolve:n,reject:i}=this.task_stack.shift();t(...e).then(n,i).finally((()=>{this.current_running_count--,this.loop()}))}}addPromiseFn(t,...e){return console.log("并发任务添加：",e),new Promise(((n,i)=>{this.task_stack.push({promiseFn:t,args:e,resolve:n,reject:i}),this.loop()}))}},e.QueryString=Qt,e.REMOVABLE_TAGS=v,e.REQUEST_FORMAT=zt,e.RESPONSE_FORMAT=Vt,e.Select=Pi,e.TRIM_BOTH=0,e.TRIM_LEFT=1,e.TRIM_RIGHT=2,e.Theme=xt,e.Tip=dn,e.Toast=Ot,e.Toc=pr,e.UPLOADER_FILE_DEFAULT_CLASS=Bi,e.UPLOADER_IMAGE_DEFAULT_CLASS=qi,e.UPLOAD_STATE_EMPTY=Vi,e.UPLOAD_STATE_ERROR=Gi,e.UPLOAD_STATE_NORMAL=ji,e.UPLOAD_STATE_PENDING=Wi,e.Uploader=Ki,e.arrayColumn=(t,e)=>{let n=[];for(let i in t)n.push(t[i][e]);return n},e.arrayDistinct=te,e.arrayFilterTree=ie,e.arrayGroup=ee,e.arrayIndex=(t,e)=>{for(let n in t)if(t[n]===e)return n;return null},e.base64Decode=t=>{let e,n,i,o,r,a,l,s="",d=0;for(t=t.replace(/\+\+[++^A-Za-z0-9+/=]/g,"");d<t.length;)o=bn.indexOf(t.charAt(d++)),r=bn.indexOf(t.charAt(d++)),a=bn.indexOf(t.charAt(d++)),l=bn.indexOf(t.charAt(d++)),e=o<<2|r>>4,n=(15&r)<<4|a>>2,i=(3&a)<<6|l,s+=String.fromCharCode(e),64!==a&&(s+=String.fromCharCode(n)),64!==l&&(s+=String.fromCharCode(i));return s=c(s),s},e.base64UrlSafeEncode=t=>d(t).replace("+","-").replace("/","_"),e.between=o,e.bindFormSubmitAsJSON=(t,e=(()=>{}))=>new Promise(((n,i)=>{let o=!1;t.addEventListener("submit",(r=>{if(o)return!1;o=!0;let a=t.action,l=t.method.toUpperCase()||"GET",s=de(t);return e(),Yt(a,s,l).then(n,i).finally((()=>{o=!1})),r.preventDefault(),!1}))})),e.bindFormUnSavedUnloadAlert=(t,e="您的表单尚未保存，是否确认离开？")=>{if(t.getAttribute(ge))return;let n=_();me[n]=e,t.setAttribute(ge,n),window.addEventListener("beforeunload",(e=>{if(!document.body.contains(t))return"";let n=fe(t);return console.log("unchanged msg",n),n?(e.preventDefault(),e.returnValue=n,n):void 0})),ae(t,!0).forEach((e=>{e.addEventListener("input",(()=>{ue[n]=de(t,!1)}))})),be(t)},e.bindImgPreviewViaSelector=Ai,e.bindNodeActive=Mt,e.bindNodeEvents=(t,e,n,i,o=!1)=>{(Array.isArray(e)?e:[e]).forEach((e=>{"active"===e?Mt(t,n,i):t.addEventListener(e,n,i)})),o&&n()},e.bindTargetContextMenu=(t,e,n={})=>(n.triggerType="contextmenu",Xo(t,e,n)),e.bindTargetDropdownMenu=(t,e,n={})=>(n.triggerType="click",Xo(t,e,n)),e.buildHtmlHidden=t=>{let e="";for(let n in t){let i=null===t[n]?"":t[n];e+=`<input type="hidden" name="${E(n)}" value="${E(i)}"/>`}return e},e.capitalize=g,e.chunk=(t,e)=>{let n=t.length;if(e<1||!n)return[];if(e>n)return[t];let i=[],o=Math.floor(n/e),r=n%e;for(let n=1;n<=o;n++)i.push(t.splice(0,e));return r&&i.push(t.splice(0,r)),i},e.convertBlobToBase64=vn,e.convertFormDataToObject=he,e.convertObjectToFormData=ve,e.copy=un,e.copyFormatted=mn,e.createDomByHtml=nt,e.createMenu=jo,e.cssSelectorEscape=t=>window.CSS&&CSS.escape?CSS.escape(t):t.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"),e.cutString=l,e.debounce=(t,e)=>{let n;return function(){let i=this,o=arguments;clearTimeout(n),n=setTimeout((function(){t.apply(i,o)}),e)}},e.decodeHTMLEntities=t=>($||($=document.createElement("div")),t=(t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),$.innerHTML=t,t=$.textContent,$.textContent="",t),e.deleteCookie=t=>{document.cookie=t+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"},e.dimension2Style=w,e.doOnce=(t,e=null,n="storage")=>{const i="TRUE";let o=t=>{switch(n.toLowerCase()){case"cookie":return st(t,i);case"storage":return window.localStorage.setItem(t,i);case"session":return window.sessionStorage.setItem(t,i);default:throw"no support:"+n}};return new Promise(((r,a)=>{(t=>{switch(n.toLowerCase()){case"cookie":return ct(t)===i;case"storage":return window.localStorage.getItem(t)===i;case"session":return window.sessionStorage.getItem(t)===i;default:throw"no support:"+n}})(t)?a():"function"==typeof e?e().then((()=>{o(t),r()}),(()=>{o(t),a()})):(o(t),r())}))},e.domChangedWatch=j,e.domContained=V,e.downloadFile=Kt,e.enterFullScreen=it,e.entityToString=t=>{let e=t.split(";");return e.pop(),e.map((t=>String.fromCharCode("x"===t[2]?parseInt(t.slice(3),16):parseInt(t.slice(2))))).join("")},e.escapeAttr=E,e.escapeHtml=y,e.eventDelegate=Ft,e.exitFullScreen=ot,e.explodeBy=(t,e)=>{let n=e.replace(/\r|\n/gm,"").split(t);return n=n.map((t=>t.trim())),n=n.filter((t=>t.length)),n},e.extract=(t,e)=>{const n=Object.keys(e),i=Object.values(e);return new Function(...n,`return \`${t}\`;`)(...i)},e.fillForm=Ho,e.findAll=z,e.findOne=H,e.fireEvent=(t,e)=>{if("createEvent"in document){let n=document.createEvent("HTMLEvents");n.initEvent(e,!1,!0),t.dispatchEvent(n)}else t.fireEvent("on"+e)},e.fixGetFormAction=t=>{let e,n=t.action;t.method&&"get"!==t.method.toLowerCase()||!n.length||new URL(n).searchParams.forEach(((n,i)=>{e=document.createElement("input"),e.type="hidden",e.name=i,e.value=n,t.appendChild(e)}))},e.formSerializeJSON=de,e.formSerializeString=se,e.formSync=re,e.formValidate=le,e.formatSize=(t,e=2)=>{if(isNaN(t))return t;let n,i="";t<0&&(i="-",t=Math.abs(t));let o="B KB MB GB TB PB".split(" ");for(n=0;t>1024;n++)t/=1024;return i+a(t,e)+o[n]},e.frequencyControl=function t(e,n,i=!1){e._frq_tm&&clearTimeout(e._frq_tm),e._frq_tm=setTimeout((()=>{t(e,n,i)}),n)},e.fromHtmlEntities=t=>(t+"").replace(/&#\d+;/gm,(function(t){return String.fromCharCode(t.match(/\d+/gm)[0])})),e.getAvailableElements=ae,e.getAverageRGB=t=>{let e,n,i,o,r={r:0,g:0,b:0},a=document.createElement("canvas"),l=a.getContext&&a.getContext("2d"),s=-4,c={r:0,g:0,b:0},d=0;if(!l)return r;i=a.height=t.naturalHeight||t.offsetHeight||t.height,n=a.width=t.naturalWidth||t.offsetWidth||t.width,l.drawImage(t,0,0);try{e=l.getImageData(0,0,n,i)}catch(t){return r}for(o=e.data.length;(s+=20)<o;)++d,c.r+=e.data[s],c.g+=e.data[s+1],c.b+=e.data[s+2];return c.r=~~(c.r/d),c.g=~~(c.g/d),c.b=~~(c.b/d),c},e.getBase64ByImg=t=>{if(!t.src)return null;if(0===t.src.indexOf("data:"))return t.src;let e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height),e.toDataURL("image/png")},e.getBase64BySrc=t=>new Promise(((e,n)=>{let i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=function(){if(200===this.status){let t=this.response;vn(t).then((t=>{e(t)})).catch((t=>{n(t)}))}},i.onerror=function(){n("Error:"+this.statusText)},i.onabort=function(){n("Request abort")},i.send()})),e.getContextDocument=()=>lt().document,e.getContextWindow=lt,e.getCookie=ct,e.getCurrentFrameDialog=()=>new Promise(((t,e)=>{if(!window.parent||!window.frameElement)return void e("no in iframe");if(!parent[ye].DialogManager)return void e("No dialog manager found.");let n=window.frameElement.getAttribute(Se);n||e("ID no found in iframe element");let i=parent[ye].DialogManager.findById(n);i?t(i):e("no dlg find:"+n)})),e.getCurrentScript=T,e.getDomDimension=J,e.getDomOffset=q,e.getElementValue=oe,e.getFocusableElements=(t=document)=>z('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled]), details:not([disabled]), summary:not(:disabled)',t).filter((t=>!W(t))),e.getFormDataAvailable=ce,e.getHash=jt,e.getHighestResFromSrcSet=yn,e.getLastMonth=(t,e)=>1===e?[t-1,12]:[t,e-1],e.getLibEntryScript=L,e.getLibModule=S,e.getLibModuleTop=N,e.getMonthLastDay=(t,e)=>new Date(t,e,0).getDate(),e.getNextMonth=(t,e)=>12===e?[t+1,1]:[t,e+1],e.getPromiseState=t=>{const e={};return Promise.race([t,e]).then((t=>t===e?P:R)).catch((()=>M))},e.getRegion=Q,e.getUTF8StrLen=t=>{let e=0,n=t.length,i=-1;for(let o=0;o<n;o++)i=t.charCodeAt(o),e+=i>=0&&i<=128?1:3;return e},e.getViewHeight=()=>window.innerHeight,e.getViewWidth=()=>window.innerWidth,e.guid=_,e.hide=D,e.highlightText=x,e.html2Text=t=>{v.forEach((e=>{t=t.replace(new RegExp(e,"ig"),"")})),t=(t=(t=(t=t.replace(/[\r|\n]/g,"")).replace(/<(\w+)([^>]*)>/g,(function(t,e,n){return b.includes(e.toLowerCase())?"\n":""}))).replace(/<\/(\w+)([^>]*)>/g,(function(t,e,n){return""}))).replace(/<[^>]+>/g,"");return[[/&nbsp;/gi," "],[/&lt;/gi,"<"],[/&gt;/gi,">"],[/&quot;/gi,'"'],[/&apos;/gi,"'"]].forEach((([e,n])=>{t=t.replace(e,n)})),t=(t=(t=t.replace(/&#(\d+);/,(function(t,e){return String.fromCharCode(e)}))).replace(/&amp;/gi,"&")).trim()},e.initAutofillButton=(t="body")=>{if(Fo)throw"autofill button already initialized";Fo=!0,K(`\n\t#auto-fill-form-btn {position: absolute; left:calc(100vw - 200px); top:50px;z-index:99999;user-select:none;opacity:0.4;transition:all 0.1s linear; border-color:#ddd; border:1px solid #aaa; --size:2em; border-radius:5px; width:var(--size); height:var(--size); line-height:var(--size); text-align:center; cursor:pointer; background-color:#fff;}\n\t#auto-fill-form-btn:hover {opacity:1}\n\t#auto-fill-form-btn:before {content:"\\e75d"; font-family:${xt.IconFont}}\n`);let e=nt('<span id="auto-fill-form-btn" title="自动填充"></span>',document.body);e.addEventListener("click",(e=>{z(`${t} form`).forEach(Ho)})),Uo(`${t}`,e)},e.inputAble=t=>t instanceof HTMLFormElement&&!(t.disabled||t.readOnly||"BUTTON"===t.tagName||"INPUT"===t.tagName&&["hidden","button","submit","reset"].includes(t.type)),e.insertStyleSheet=K,e.isButton=B,e.isElement=t=>{try{return t instanceof HTMLElement}catch(e){return"object"==typeof t&&1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument}},e.isEquals=Zt,e.isInFullScreen=rt,e.isJSON=t=>{let e=!1;try{JSON.parse(t),e=!0}catch(t){}return e},e.isNodeHidden=W,e.isNum=f,e.isObject=O,e.isPromise=t=>t&&"object"==typeof t&&t.then&&"function"==typeof t.then,e.isValidUrl=t=>{try{return Boolean(new URL(t))}catch(t){return!1}},e.keepDomInContainer=(t,e=document.body)=>{Y({left:t.left,top:t.top,width:t.clientWidth,height:t.clientHeight})},e.keepRectCenter=(t,e,n={left:0,top:0,width:window.innerWidth,height:window.innerHeight})=>[Math.max((n.width-t)/2+n.left,0),Math.max((n.height-e)/2+n.top,0)],e.keepRectInContainer=Y,e.loadCss=(t,e=!1)=>(!e&&X[t]||(X[t]=new Promise(((e,n)=>{let i=document.createElement("link");i.rel="stylesheet",i.href=t,i.onload=()=>{e()},i.onerror=()=>{n()},document.head.append(i)}))),X[t]),e.loadImgBySrc=$n,e.loadScript=(t,e=!1)=>(!e&&X[t]||(X[t]=new Promise(((e,n)=>{let i=document.createElement("script");i.src=t,i.onload=()=>{e()},i.onerror=()=>{n()},document.head.append(i)}))),X[t]),e.matchParent=(t,e)=>t.closest(e),e.mergeDeep=k,e.mergerUriParam=Gt,e.monthsOffsetCalc=(t,e=new Date)=>{let n=e.getFullYear(),i=e.getMonth()+1;if(i+=t,i>12){let t=Math.floor((i-1)/12);i=i%12==0?12:i%12,n+=t}else if(i<=0){i=Math.abs(i);let t=Math.floor((i+12)/12),e=i%12;0===e?(n-=t,i=12):(n-=t,i=Math.abs(12-e))}return{year:n,month:i}},e.nodeHighlight=et,e.objectGetByPath=(t,e,n=".")=>{let i=e.split(n);for(let e=0,n=i.length;e<n;e++){if(void 0===t[i[e]])return null;t=t[i[e]]}return t},e.objectPushByPath=ne,e.onDocReady=t=>{"complete"===document.readyState?t():document.addEventListener("DOMContentLoaded",t)},e.onDomTreeChange=G,e.onHover=(t,e,n)=>{t.addEventListener("mouseover",e),t.addEventListener("mouseout",n)},e.onReportApi=Io,e.onStateChange=t=>{ko||(ko=!0,window.addEventListener("popstate",(t=>{let e=t.state??{},n=Qt.parse(jt());Po({...e,...n})}))),Oo.push(t)},e.openLinkWithoutReferer=t=>{let e=window.open("about:blank");return e.document.write('<meta http-equiv="refresh" content="0;url='+t+'">'),e.document.close(),!1},e.prettyTime=(t,e="")=>{let n=0,i=0,o=0,r=0;t>Do&&(n=Math.floor(t/Do),t-=n*Do),t>Mo&&(i=Math.floor(t/Mo),t-=i*Mo),t>Ro&&(o=Math.floor(t/Ro),t-=o*Ro),t>1e3&&(r=Math.floor(t/1e3),t-=1e3*r);let a="";return a+=n?`${n}天`:"",a+=a||i?`${e}${i}小时`:"",a+=a||o?`${e}${o}分`:"",a+=a||r?`${e}${r}秒`:"",a.trim()},e.pushState=(t,e="")=>{let n=location.href.replace(/#.*$/g,"")+"#"+Qt.stringify(t);window.history.pushState(t,e,n),Po(t)},e.randomInt=r,e.randomSentence=u,e.randomString=h,e.randomWords=p,e.readFileInLine=(t,e,n=null,i=null)=>{const o=new FileReader;let r=0,a="";const l=()=>{if(r<t.size){let e=t.slice(r,r+1024);o.readAsArrayBuffer(e),r+=1024}else n()};o.onload=t=>{if(a+=(new TextDecoder).decode(new Uint8Array(o.result)),a.indexOf("\n")>=0){let t=!1,n=a.split("\n");if(a=n.pop(),n.find((n=>{if(!1===e(n))return t=!0,!0})),t)return}l()},o.onerror=t=>{console.error(t),i(t)},l()},e.rectAssoc=(t,e)=>t.left<=e.left?t.left+t.width>=e.left&&(o(e.top,t.top,t.top+t.height)||o(e.top+e.height,t.top,t.top+t.height)||e.top>=t.top&&e.height>=t.height):e.left+e.width>=t.left&&(o(t.top,e.top,e.top+e.height)||o(t.top+t.height,e.top,e.top+e.height)||t.top>=e.top&&t.height>=e.height),e.rectInLayout=Z,e.regQuote=s,e.remove=F,e.repaint=function(t,e=0){setTimeout((()=>{try{t.hidden=!0,t.offsetHeight,t.hidden=!1}catch(t){}}),e)},e.requestJSON=Yt,e.resetFormChangedState=be,e.resolveFileExtension=kt,e.resolveFileName=Pt,e.round=a,e.scaleFixCenter=({contentWidth:t,contentHeight:e,containerWidth:n,containerHeight:i,spacing:o=0,zoomIn:r=!1})=>{if(t<=n&&e<=i&&!r)return{width:t,height:e,left:(n-t)/2,top:(i-e)/2};let a=n/t,l=i/e,s=Math.min(a,l);return{width:t*s-2*o,height:e*s-2*o,left:(n-t*s)/2+o,top:(i-e*s)/2+o}},e.serializePhpFormToJSON=(t,e=!0)=>{let n=ce(t,e),i={},o={};return n.forEach((t=>{let[e,n]=t;if(e.indexOf("[")<0)return void(i[e]=n);void 0===o[e]?o[e]=0:o[e]++;let r=e.replace(/\[]$/,"."+o[e]).replace(/]/g,"").replace(/\[/g,".");ne(r,n,i,".")})),i},e.setContextWindow=t=>{at=t},e.setCookie=st,e.setHash=t=>{location.href=location.href.replace(/#.*$/g,"")+"#"+Qt.stringify(t)},e.setStyle=tt,e.show=U,e.showContextMenu=(t,e)=>{Jo();let n=jo(t);Yo=n;let i=Ko(n,{left:e.left,top:e.top});n.style.left=w(i.left),n.style.top=w(i.top),n.style.display="block"},e.showImgListPreview=Ti,e.showImgPreview=_i,e.showNoviceGuide=(t,e={})=>{e=Object.assign({next_button_text:"下一步",prev_button_text:"上一步",finish_button_text:"完成",top_close:!1,cover_included:!1,show_counter:!1,on_finish:function(){}},e);let n=t.length,i=function(){if(!t.length)return rr(),void e.on_finish();let o=t[0];t.shift();let r,a=e.cover_included&&n===t.length+1;r=a?or(null,document.body.offsetWidth):or(o.relateNode);let l=`<div class="${er}-next-wrap">`;t.length+2<=n.length&&(l+=`<span class="${er}-btn ${er}-prev-btn ">${e.prev_button_text}</span> `),t.length&&e.next_button_text&&(l+=`<span class="${er}-btn ${er}-next-btn">${e.next_button_text}</span>`),!t.length&&e.finish_button_text&&(l+=`<span class="${er}-btn ${er}-finish-btn">${e.finish_button_text}</span>`),e.show_counter&&(l+=`<span class="${er}-counter">${n.length-t.length}/${n.length}</span>`),l+="</div>";let s=new dn(`<div class="${er}-content">${o.content}</div>${l}`,a?r:o.relateNode,{showCloseButton:e.top_close,dir:a?6:"auto"});s.onHide.listen((function(){s.destroy(),rr(),e.on_finish()})),s.onShow.listen((function(){s.dom.style.zIndex="10001",s.dom.querySelector(`.${er}-next-btn,.${er}-finish-btn`).addEventListener("click",(function(){s.destroy(),i()}));let e=s.dom.querySelector(`.${er}-prev-btn`);e&&e.addEventListener("click",(function(){s.destroy();let e=t.length;t.unshift(n[n.length-e-1]),t.unshift(n[n.length-e-2]),i()}))})),s.show()};i()},e.sortByKey=t=>Object.keys(t).sort().reduce((function(e,n){return e[n]=t[n],e}),{}),e.sortable=(t,e=null,n=(()=>{}))=>{let i=null,o=null,r=(e=e||{}).ClassOnDrag||ar,a=e.ClassProxy||lr,l=()=>{Array.from(t.children).forEach((t=>t.setAttribute("draggable","true")))};G(t,l,!1),l(),t.addEventListener("dragover",(t=>{t.preventDefault()})),t.addEventListener("dragstart",(e=>{if(e.target===t)return;let n=sr(t,e.target);return i=n,o=t,i.classList.add(a),setTimeout((()=>{n.classList.remove(a),n.classList.add(r)}),0),!1})),t.addEventListener("dragenter",(e=>{if(e.target===t)return;let r=sr(t,e.target);if(!i||o!==t||r===t||r===i)return;let a=Array.from(t.children),l=a.indexOf(i),s=a.indexOf(r);l>s?t.insertBefore(i,r.previousSibling):t.insertBefore(i,r.nextSibling),n(l,s)})),t.addEventListener("dragend",(e=>{if(e.target===t)return;let n=sr(t,e.target);i=null,o=null,n.classList.remove(r)}))},e.strToPascalCase=m,e.stringToEntity=(t,e)=>{let n=t.split("");return e=e||0,n.map((t=>`&#${e?"x"+t.charCodeAt(0).toString(16):t.charCodeAt(0)};`)).join("")},e.stripSlashes=t=>(t+"").replace(/\\(.?)/g,(function(t,e){switch(e){case"\\":return"\\";case"0":return"\0";case"":return"";default:return e}})),e.tabConnect=(t,e,n={})=>{let{contentActiveClass:i="active",tabActiveClass:o="active",triggerEvent:r="click"}=n;"string"==typeof t&&(t=z(t)),"string"==typeof e&&(e=z(e)),t.forEach(((n,a)=>{n.addEventListener(r,(r=>{e.forEach((t=>{t.classList.remove(i)})),e[a].classList.add(i),t.forEach((t=>{t.classList.remove(o)})),n.classList.add(o)}))}))},e.throttle=(t,e)=>{let n,i,o=0;return function(){let r=+new Date;n=this,i=arguments,r-o>e&&(t.apply(n,i),o=r)}},e.toHtmlEntities=t=>t.replace(/./gm,(function(t){return t.match(/[a-z0-9\s]+/i)?t:"&#"+t.charCodeAt(0)+";"})),e.toggle=(t,e)=>{e?U(t):D(t)},e.toggleFullScreen=t=>new Promise(((e,n)=>{rt()?ot().then(e).catch(n):it(t).then(e).catch(n)})),e.trans=pn,e.triggerDomEvent=Dt,e.trim=(t,e="",n=0)=>{if(e.length){let i=new RegExp("^["+s(e)+"]+"),o=new RegExp("["+s(e)+"]+$");return 1===n?t.replace(i,""):2===n?t.replace(o,""):t.replace(i,"").replace(o,"")}return 0===n?t.trim():1===n?t.trimStart():n===t.trimEnd()},e.unescapeHtml=t=>String(t).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/<br.*>/,"\n"),e.uploadFile=Jt,e.utf8Decode=c,e.utf8Encode=d,e.validateFormChanged=fe,e.versionCompare=(t,e,n)=>{let i=n+1,o=I(t),r=I(e);o.length>i&&(o.length=i),r.length>i&&(r.length=i);let a,l=Math.min(o.length,r.length);for(a=0;a<l;a+=1)if(o[a]!==r[a])return o[a]<r[a]?-1:1;return o.length===r.length?0:o.length<r.length?-1:1}}));
